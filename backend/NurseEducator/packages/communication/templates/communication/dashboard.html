{% comment %} {% extends 'frame/_base.html' %} {% endcomment %}
{% load zstatic %}

<!DOCTYPE html>
<html>
{% block head %}

<head>
    <title>{{page_title}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Source+Code+Pro:wght@400;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link
        href="https://cdn.datatables.net/v/bs5/jszip-3.10.1/dt-1.13.6/af-2.6.0/b-2.4.2/b-colvis-2.4.2/b-html5-2.4.2/b-print-2.4.2/cr-1.7.0/date-1.5.1/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.1/rr-1.4.1/sc-2.2.0/sb-1.6.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.css"
        rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script
        src="https://cdn.datatables.net/v/bs5/jszip-3.10.1/dt-1.13.6/af-2.6.0/b-2.4.2/b-colvis-2.4.2/b-html5-2.4.2/b-print-2.4.2/cr-1.7.0/date-1.5.1/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.1/rr-1.4.1/sc-2.2.0/sb-1.6.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.js"></script>

    <script src="https:////cdn.datatables.net/plug-ins/1.13.6/pagination/input.js"></script>

    <link href="https://cdn.datatables.net/fixedcolumns/4.3.0/css/fixedColumns.bootstrap5.min.css">
    </link>
    <script src="https://cdn.datatables.net/fixedcolumns/4.3.0/js/dataTables.fixedColumns.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&family=Source+Code+Pro:wght@400;600;700&display=swap"
        rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.6.0/tinycolor.min.js"
        integrity="sha512-AvCfbOQzCVi2ctVWF4m89jLwTn/zVPJuS7rhiKyY3zqyCdbPqtvNa0I628GJqPytbowfFjkAGOpq85E5kQc40Q=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Trumbowyg/2.27.3/trumbowyg.min.js"
        integrity="sha512-YJgZG+6o3xSc0k5wv774GS+W1gx0vuSI/kr0E0UylL/Qg/noNspPtYwHPN9q6n59CTR/uhgXfjDXLTRI+uIryg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="{% zstatic 'packages/communication/style.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/jquery-toast-plugin@1.3.2/dist/jquery.toast.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-toast-plugin@1.3.2/dist/jquery.toast.min.css">

</head>
{% endblock %}
{% block page_content %}

<body className="" style="width: 100%; display: flex;
  flex-flow: column;
  height: 100%; overflow: hidden;">
    <div class="overlay-spinner" style="display: none;"></div>
    <form method="post">{% csrf_token %}</form>
    <div class="com-pkg-heading">
        Communications
    </div>
    <div class="com-pkg-tabs-container">

        <div class="com-pkg-tabs">
            <div class="com-pkg-menu-border"></div>
            <div class="com-pkg-menu-container">
                <a class="com-pkg-menu-item active" data-tab="com-pkg-email-tab">Email</a>
                <a class="com-pkg-menu-item" data-tab="com-pkg-sms-tab">SMS</a>
                <a class="com-pkg-menu-item" data-tab="com-pkg-Telephoney-tab">Telephony</a>
                <a class="com-pkg-menu-item" data-tab="com-pkg-video-call-tab">Video Call</a>
            </div>
            <div style="width: 100%; height: 1px; background: #DDE2E5"></div>
        </div>

        <div class="com-pkg-tab-content" style="width: 100%; display: flex; flex: 1;">
            <div id="com-pkg-email-tab" class="com-pkg-tab-content active">

                <div style="border-right: 1px solid #DDE2E5; width:20%; height: 100%">
                    <div class="com-pkg-label">Emails</div>
                    <div class="com-pkg-cta-btn" id="compose-btn" data-bs-toggle="offcanvas"
                        data-bs-target="#com-pkg-cta-email-modal" aria-controls="com-pkg-cta-email-modal">
                        <div class="com-pkg-cta-btn-text">Compose</div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                            <path
                                d="M16.4225 0.590835C15.604 -0.196945 14.3145 -0.196945 13.4951 0.590835L12.0296 2.06227L5.95743 8.17013C5.6935 8.43734 5.50546 8.77136 5.41404 9.1375L4.81027 11.5669C4.7059 11.9807 4.79733 12.4197 5.05695 12.7572C5.31658 13.0947 5.71679 13.2925 6.14116 13.2951C6.25588 13.2951 6.36974 13.2804 6.48101 13.2526L8.89619 12.6453C9.25931 12.5533 9.59224 12.3642 9.85706 12.097L15.9293 5.98911L17.3938 4.51681C18.202 3.70386 18.202 2.38599 17.3938 1.57304L16.4225 0.590835ZM8.88482 11.1157C8.79598 11.2042 8.68558 11.2675 8.56483 11.2979L6.14964 11.9061L6.75428 9.47668C6.78446 9.35435 6.84656 9.24329 6.93454 9.15394L12.5194 3.53716L14.4713 5.49964L8.88482 11.1157ZM16.4225 3.5346L15.4453 4.51585L13.4934 2.55337L14.4698 1.57211C14.7423 1.30923 15.1727 1.30923 15.4453 1.57211L16.4225 2.55337C16.6917 2.82407 16.6916 3.2639 16.4225 3.5346Z"
                                fill="white" />
                            <path
                                d="M3.45011 18H13.1104C14.0247 17.9991 14.9019 17.633 15.5488 16.9823C16.1957 16.3316 16.5597 15.4492 16.5605 14.5296V8.01216C16.5605 7.62868 16.2518 7.31809 15.8705 7.31809C15.4893 7.31809 15.1805 7.62868 15.1805 8.01216V14.5296C15.1805 15.6791 14.2533 16.6118 13.1104 16.6118H3.45011C2.30726 16.6118 1.38005 15.6791 1.38005 14.5296V4.81254C1.38005 3.66297 2.30726 2.73031 3.45011 2.73031H10.1019C10.4832 2.73031 10.792 2.41972 10.792 2.03624C10.792 1.65275 10.4832 1.34216 10.1019 1.34216H3.45011C2.53584 1.34303 1.65864 1.70915 1.01174 2.35984C0.36484 3.01054 0.000861148 3.89287 0 4.81254V14.5296C0.000862473 15.4492 0.36484 16.3316 1.01174 16.9823C1.65864 17.633 2.53582 17.9991 3.45011 18Z"
                                fill="white" />
                        </svg>
                    </div>

                    <div class="com-pkg-email-tabs" style="margin-top:24px;">
                        {% comment %} received {% endcomment %}
                        <div class="com-pkg-tab-item active" data-tab="com-pkg-email-received">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path
                                    d="M2.5 16.875C2.15468 16.875 1.875 16.5953 1.875 16.25V3.75C1.875 3.40468 2.15468 3.125 2.5 3.125C2.84532 3.125 3.125 3.40468 3.125 3.75V16.25C3.125 16.5953 2.84532 16.875 2.5 16.875Z"
                                    fill="black" />
                                <path
                                    d="M17.5 16.875C17.1547 16.875 16.875 16.5953 16.875 16.25V3.75C16.875 3.40468 17.1547 3.125 17.5 3.125C17.8453 3.125 18.125 3.40468 18.125 3.75V16.25C18.125 16.5953 17.8453 16.875 17.5 16.875Z"
                                    fill="black" />
                                <path
                                    d="M2.5 4.375C2.15468 4.375 1.875 4.09532 1.875 3.75C1.875 3.06094 2.43594 2.5 3.125 2.5C3.47032 2.5 3.75 2.77968 3.75 3.125C3.75 3.47032 3.47032 3.75 3.125 3.75H3.12422C3.12422 4.09532 2.84532 4.375 2.5 4.375Z"
                                    fill="black" />
                                <path
                                    d="M16.875 3.75H3.125C2.77968 3.75 2.5 3.47032 2.5 3.125C2.5 2.77968 2.77968 2.5 3.125 2.5H16.875C17.2203 2.5 17.5 2.77968 17.5 3.125C17.5 3.47032 17.2203 3.75 16.875 3.75Z"
                                    fill="black" />
                                <path
                                    d="M17.5 4.375C17.1547 4.375 16.875 4.09532 16.875 3.75V3.74922C16.5297 3.74922 16.25 3.46954 16.25 3.12422C16.25 2.77968 16.5297 2.5 16.875 2.5C17.5641 2.5 18.125 3.06094 18.125 3.75C18.125 4.09532 17.8453 4.375 17.5 4.375Z"
                                    fill="black" />
                                <path
                                    d="M16.875 17.5C16.5297 17.5 16.25 17.2203 16.25 16.875C16.25 16.5297 16.5297 16.25 16.875 16.25H16.8758C16.8758 15.9047 17.1555 15.625 17.5008 15.625C17.8453 15.625 18.125 15.9047 18.125 16.25C18.125 16.9391 17.5641 17.5 16.875 17.5Z"
                                    fill="black" />
                                <path
                                    d="M16.875 17.5H3.125C2.77968 17.5 2.5 17.2203 2.5 16.875C2.5 16.5297 2.77968 16.25 3.125 16.25H16.875C17.2203 16.25 17.5 16.5297 17.5 16.875C17.5 17.2203 17.2203 17.5 16.875 17.5Z"
                                    fill="black" />
                                <path
                                    d="M3.125 17.5C2.43594 17.5 1.875 16.9391 1.875 16.25C1.875 15.9047 2.15468 15.625 2.5 15.625C2.84532 15.625 3.125 15.9047 3.125 16.25V16.2508C3.47032 16.2508 3.75 16.5305 3.75 16.8758C3.75 17.2203 3.47032 17.5 3.125 17.5Z"
                                    fill="black" />
                                <path
                                    d="M17.5 11.25H12.5C12.1547 11.25 11.875 10.9703 11.875 10.625C11.875 10.2797 12.1547 10 12.5 10H17.5C17.8453 10 18.125 10.2797 18.125 10.625C18.125 10.9703 17.8453 11.25 17.5 11.25Z"
                                    fill="black" />
                                <path
                                    d="M7.5 11.25H2.5C2.15468 11.25 1.875 10.9703 1.875 10.625C1.875 10.2797 2.15468 10 2.5 10H7.5C7.84532 10 8.125 10.2797 8.125 10.625C8.125 10.9703 7.84532 11.25 7.5 11.25Z"
                                    fill="black" />
                                <path
                                    d="M10 13.75C8.30624 13.75 6.875 12.3188 6.875 10.625C6.875 10.2797 7.15468 10 7.5 10C7.84532 10 8.125 10.2797 8.125 10.625C8.125 11.6414 8.9836 12.5 10 12.5C11.0164 12.5 11.875 11.6414 11.875 10.625C11.875 10.2797 12.1547 10 12.5 10C12.8453 10 13.125 10.2797 13.125 10.625C13.125 12.3188 11.6938 13.75 10 13.75Z"
                                    fill="black" />
                            </svg>
                            received <span>(<span id="unread-received-count">0</span> unread)</span>
                        </div>
                        {% comment %} sent {% endcomment %}
                        <div class="com-pkg-tab-item" data-tab="com-pkg-email-sent">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path
                                    d="M17.4062 3.12504C17.2406 2.93051 16.9734 2.85628 16.7312 2.93754L2.8688 7.63134C2.59926 7.72587 2.42896 7.9915 2.45396 8.27588C2.47896 8.56026 2.69302 8.7915 2.97506 8.8376H3.16256C4.99068 9.05166 6.66576 9.9626 7.83916 11.3806C9.0126 12.7986 9.59384 14.6142 9.4626 16.4502C9.45323 16.7424 9.64776 17.0025 9.93136 17.0752H10.0876C10.3204 17.0768 10.5345 16.9494 10.6439 16.744L17.5001 3.82516C17.6165 3.5947 17.5789 3.31644 17.4062 3.12504ZM10.5312 14.2938C10.2773 12.8954 9.65854 11.5884 8.73744 10.5056C7.81712 9.42204 6.62644 8.60174 5.28744 8.12524L15.625 4.62524L10.5312 14.2938Z"
                                    fill="#212429" />
                            </svg>
                            sent
                        </div>
                        {% comment %} draft {% endcomment %}
                        <div class="com-pkg-tab-item" data-tab="com-pkg-email-drafts">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M3.54138 3.33358C3.54138 2.06796 4.56794 1.04138 5.83358 1.04138H14.1664C15.432 1.04138 16.4586 2.06794 16.4586 3.33358V16.6664C16.4586 17.932 15.432 18.9586 14.1664 18.9586H5.83358C4.56796 18.9586 3.54138 17.932 3.54138 16.6664V3.33358ZM5.83358 2.2914C5.2578 2.2914 4.7914 2.7578 4.7914 3.33358V16.6664C4.7914 17.2422 5.2578 17.7086 5.83358 17.7086H14.1664C14.7422 17.7086 15.2086 17.2422 15.2086 16.6664V3.33358C15.2086 2.7578 14.7422 2.2914 14.1664 2.2914H5.83358Z"
                                    fill="black" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M6.04138 13.3336C6.04138 13.6782 6.32184 13.9586 6.66638 13.9586H10.8336C11.1781 13.9586 11.4586 13.6782 11.4586 13.3336C11.4586 12.9883 11.1781 12.7086 10.8336 12.7086H6.66638C6.32184 12.7086 6.04138 12.9883 6.04138 13.3336Z"
                                    fill="black" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M6.04138 10C6.04138 10.3453 6.32184 10.625 6.66638 10.625H13.3336C13.6781 10.625 13.9586 10.3453 13.9586 10C13.9586 9.65468 13.6781 9.375 13.3336 9.375H6.66638C6.32184 9.375 6.04138 9.65468 6.04138 10Z"
                                    fill="black" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M6.04138 6.66638C6.04138 7.0117 6.32184 7.29138 6.66638 7.29138H13.3336C13.6781 7.29138 13.9586 7.0117 13.9586 6.66638C13.9586 6.32184 13.6781 6.04138 13.3336 6.04138H6.66638C6.32184 6.04138 6.04138 6.32184 6.04138 6.66638Z"
                                    fill="black" />
                            </svg>
                            draft <span>(<span id="draft-count">0</span>)</span>
                        </div>
                    </div>
                </div>
                {% comment %} email tabs {% endcomment %}
                <div style="width: 100%">
                    {% comment %} email-received {% endcomment %}
                    <div id="com-pkg-email-received" class="com-pkg-individual-tab-content active">

                        <table id="com-pkg-email-received-table" class="display" style="width: 100%">
                        </table>
                    </div>
                    {% comment %} email-sent {% endcomment %}
                    <div id="com-pkg-email-sent" class="com-pkg-individual-tab-content">
                        <table id="com-pkg-email-sent-table" class="display" style="width: 100%">
                        </table>
                    </div>
                    {% comment %} email-drafts {% endcomment %}
                    <div id="com-pkg-email-drafts" class="com-pkg-individual-tab-content">
                        <table id="com-pkg-email-draft-table" class="display" style="width: 100%">
                        </table>
                    </div>
                </div>
            </div>
            <div id="com-pkg-sms-tab" class="com-pkg-tab-content ">
                <div style="border-right: 1px solid #DDE2E5; width:20%; height: 100%">
                    <div class="com-pkg-label">SMS</div>
                    <div class="com-pkg-cta-btn" id="new-sms-btn" data-bs-toggle="offcanvas"
                        data-bs-target="#com-pkg-cta-sms-modal" aria-controls="com-pkg-cta-sms-modal">
                        <div class="com-pkg-cta-btn-text">New SMS</div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                            <path
                                d="M16.4225 0.590835C15.604 -0.196945 14.3145 -0.196945 13.4951 0.590835L12.0296 2.06227L5.95743 8.17013C5.6935 8.43734 5.50546 8.77136 5.41404 9.1375L4.81027 11.5669C4.7059 11.9807 4.79733 12.4197 5.05695 12.7572C5.31658 13.0947 5.71679 13.2925 6.14116 13.2951C6.25588 13.2951 6.36974 13.2804 6.48101 13.2526L8.89619 12.6453C9.25931 12.5533 9.59224 12.3642 9.85706 12.097L15.9293 5.98911L17.3938 4.51681C18.202 3.70386 18.202 2.38599 17.3938 1.57304L16.4225 0.590835ZM8.88482 11.1157C8.79598 11.2042 8.68558 11.2675 8.56483 11.2979L6.14964 11.9061L6.75428 9.47668C6.78446 9.35435 6.84656 9.24329 6.93454 9.15394L12.5194 3.53716L14.4713 5.49964L8.88482 11.1157ZM16.4225 3.5346L15.4453 4.51585L13.4934 2.55337L14.4698 1.57211C14.7423 1.30923 15.1727 1.30923 15.4453 1.57211L16.4225 2.55337C16.6917 2.82407 16.6916 3.2639 16.4225 3.5346Z"
                                fill="white" />
                            <path
                                d="M3.45011 18H13.1104C14.0247 17.9991 14.9019 17.633 15.5488 16.9823C16.1957 16.3316 16.5597 15.4492 16.5605 14.5296V8.01216C16.5605 7.62868 16.2518 7.31809 15.8705 7.31809C15.4893 7.31809 15.1805 7.62868 15.1805 8.01216V14.5296C15.1805 15.6791 14.2533 16.6118 13.1104 16.6118H3.45011C2.30726 16.6118 1.38005 15.6791 1.38005 14.5296V4.81254C1.38005 3.66297 2.30726 2.73031 3.45011 2.73031H10.1019C10.4832 2.73031 10.792 2.41972 10.792 2.03624C10.792 1.65275 10.4832 1.34216 10.1019 1.34216H3.45011C2.53584 1.34303 1.65864 1.70915 1.01174 2.35984C0.36484 3.01054 0.000861148 3.89287 0 4.81254V14.5296C0.000862473 15.4492 0.36484 16.3316 1.01174 16.9823C1.65864 17.633 2.53582 17.9991 3.45011 18Z"
                                fill="white" />
                        </svg>
                    </div>

                    <div class="com-pkg-sms-tabs" style="margin-top:24px;">
                        {% comment %} sent {% endcomment %}
                        <div class="com-pkg-tab-item active" data-tab="com-pkg-sms-sent">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path
                                    d="M17.4062 3.12504C17.2406 2.93051 16.9734 2.85628 16.7312 2.93754L2.8688 7.63134C2.59926 7.72587 2.42896 7.9915 2.45396 8.27588C2.47896 8.56026 2.69302 8.7915 2.97506 8.8376H3.16256C4.99068 9.05166 6.66576 9.9626 7.83916 11.3806C9.0126 12.7986 9.59384 14.6142 9.4626 16.4502C9.45323 16.7424 9.64776 17.0025 9.93136 17.0752H10.0876C10.3204 17.0768 10.5345 16.9494 10.6439 16.744L17.5001 3.82516C17.6165 3.5947 17.5789 3.31644 17.4062 3.12504ZM10.5312 14.2938C10.2773 12.8954 9.65854 11.5884 8.73744 10.5056C7.81712 9.42204 6.62644 8.60174 5.28744 8.12524L15.625 4.62524L10.5312 14.2938Z"
                                    fill="#212429" />
                            </svg>
                            sent
                        </div>
                        {% comment %} <div class="com-pkg-tab-item" data-tab="com-pkg-sms-drafts">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M3.54138 3.33358C3.54138 2.06796 4.56794 1.04138 5.83358 1.04138H14.1664C15.432 1.04138 16.4586 2.06794 16.4586 3.33358V16.6664C16.4586 17.932 15.432 18.9586 14.1664 18.9586H5.83358C4.56796 18.9586 3.54138 17.932 3.54138 16.6664V3.33358ZM5.83358 2.2914C5.2578 2.2914 4.7914 2.7578 4.7914 3.33358V16.6664C4.7914 17.2422 5.2578 17.7086 5.83358 17.7086H14.1664C14.7422 17.7086 15.2086 17.2422 15.2086 16.6664V3.33358C15.2086 2.7578 14.7422 2.2914 14.1664 2.2914H5.83358Z"
                                    fill="black" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M6.04138 13.3336C6.04138 13.6782 6.32184 13.9586 6.66638 13.9586H10.8336C11.1781 13.9586 11.4586 13.6782 11.4586 13.3336C11.4586 12.9883 11.1781 12.7086 10.8336 12.7086H6.66638C6.32184 12.7086 6.04138 12.9883 6.04138 13.3336Z"
                                    fill="black" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M6.04138 10C6.04138 10.3453 6.32184 10.625 6.66638 10.625H13.3336C13.6781 10.625 13.9586 10.3453 13.9586 10C13.9586 9.65468 13.6781 9.375 13.3336 9.375H6.66638C6.32184 9.375 6.04138 9.65468 6.04138 10Z"
                                    fill="black" />
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M6.04138 6.66638C6.04138 7.0117 6.32184 7.29138 6.66638 7.29138H13.3336C13.6781 7.29138 13.9586 7.0117 13.9586 6.66638C13.9586 6.32184 13.6781 6.04138 13.3336 6.04138H6.66638C6.32184 6.04138 6.04138 6.32184 6.04138 6.66638Z"
                                    fill="black" />
                            </svg>
                            draft <span>(<span id="draft-count">0</span>)</span>
                        </div> {% endcomment %}
                    </div>
                </div>
                {% comment %} email tabs {% endcomment %}
                <div style="width: 100%">
                    
                    <div id="com-pkg-sms-sent" class="com-pkg-individual-tab-content active">
                        <table id="com-pkg-sms-sent-table" class="display" style="width: 100%"> </table>
                    </div>

                 

                </div>
            </div>
            <div id="com-pkg-Telephoney-tab" class="com-pkg-tab-content">
                <div style="border-right: 1px solid #DDE2E5; width:20%; height: 100%">
                    <div class="com-pkg-label">Telephony</div>
                    <div class="com-pkg-cta-btn" id="new-call-btn" data-bs-toggle="offcanvas"
                        data-bs-target="#com-pkg-cta-telephony-modal" aria-controls="com-pkg-cta-telephony-modal">
                        <div class="com-pkg-cta-btn-text">New Call</div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                            <path
                                d="M16.4225 0.590835C15.604 -0.196945 14.3145 -0.196945 13.4951 0.590835L12.0296 2.06227L5.95743 8.17013C5.6935 8.43734 5.50546 8.77136 5.41404 9.1375L4.81027 11.5669C4.7059 11.9807 4.79733 12.4197 5.05695 12.7572C5.31658 13.0947 5.71679 13.2925 6.14116 13.2951C6.25588 13.2951 6.36974 13.2804 6.48101 13.2526L8.89619 12.6453C9.25931 12.5533 9.59224 12.3642 9.85706 12.097L15.9293 5.98911L17.3938 4.51681C18.202 3.70386 18.202 2.38599 17.3938 1.57304L16.4225 0.590835ZM8.88482 11.1157C8.79598 11.2042 8.68558 11.2675 8.56483 11.2979L6.14964 11.9061L6.75428 9.47668C6.78446 9.35435 6.84656 9.24329 6.93454 9.15394L12.5194 3.53716L14.4713 5.49964L8.88482 11.1157ZM16.4225 3.5346L15.4453 4.51585L13.4934 2.55337L14.4698 1.57211C14.7423 1.30923 15.1727 1.30923 15.4453 1.57211L16.4225 2.55337C16.6917 2.82407 16.6916 3.2639 16.4225 3.5346Z"
                                fill="white" />
                            <path
                                d="M3.45011 18H13.1104C14.0247 17.9991 14.9019 17.633 15.5488 16.9823C16.1957 16.3316 16.5597 15.4492 16.5605 14.5296V8.01216C16.5605 7.62868 16.2518 7.31809 15.8705 7.31809C15.4893 7.31809 15.1805 7.62868 15.1805 8.01216V14.5296C15.1805 15.6791 14.2533 16.6118 13.1104 16.6118H3.45011C2.30726 16.6118 1.38005 15.6791 1.38005 14.5296V4.81254C1.38005 3.66297 2.30726 2.73031 3.45011 2.73031H10.1019C10.4832 2.73031 10.792 2.41972 10.792 2.03624C10.792 1.65275 10.4832 1.34216 10.1019 1.34216H3.45011C2.53584 1.34303 1.65864 1.70915 1.01174 2.35984C0.36484 3.01054 0.000861148 3.89287 0 4.81254V14.5296C0.000862473 15.4492 0.36484 16.3316 1.01174 16.9823C1.65864 17.633 2.53582 17.9991 3.45011 18Z"
                                fill="white" />
                        </svg>
                    </div>

                    <div class="com-pkg-telephony-tabs" style="margin-top:24px;">
                        {% comment %} incoming {% endcomment %}
                        <div class="com-pkg-tab-item active" data-tab="com-pkg-telephony-incoming">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path
                                    d="M2.5 16.875C2.15468 16.875 1.875 16.5953 1.875 16.25V3.75C1.875 3.40468 2.15468 3.125 2.5 3.125C2.84532 3.125 3.125 3.40468 3.125 3.75V16.25C3.125 16.5953 2.84532 16.875 2.5 16.875Z"
                                    fill="black" />
                                <path
                                    d="M17.5 16.875C17.1547 16.875 16.875 16.5953 16.875 16.25V3.75C16.875 3.40468 17.1547 3.125 17.5 3.125C17.8453 3.125 18.125 3.40468 18.125 3.75V16.25C18.125 16.5953 17.8453 16.875 17.5 16.875Z"
                                    fill="black" />
                                <path
                                    d="M2.5 4.375C2.15468 4.375 1.875 4.09532 1.875 3.75C1.875 3.06094 2.43594 2.5 3.125 2.5C3.47032 2.5 3.75 2.77968 3.75 3.125C3.75 3.47032 3.47032 3.75 3.125 3.75H3.12422C3.12422 4.09532 2.84532 4.375 2.5 4.375Z"
                                    fill="black" />
                                <path
                                    d="M16.875 3.75H3.125C2.77968 3.75 2.5 3.47032 2.5 3.125C2.5 2.77968 2.77968 2.5 3.125 2.5H16.875C17.2203 2.5 17.5 2.77968 17.5 3.125C17.5 3.47032 17.2203 3.75 16.875 3.75Z"
                                    fill="black" />
                                <path
                                    d="M17.5 4.375C17.1547 4.375 16.875 4.09532 16.875 3.75V3.74922C16.5297 3.74922 16.25 3.46954 16.25 3.12422C16.25 2.77968 16.5297 2.5 16.875 2.5C17.5641 2.5 18.125 3.06094 18.125 3.75C18.125 4.09532 17.8453 4.375 17.5 4.375Z"
                                    fill="black" />
                                <path
                                    d="M16.875 17.5C16.5297 17.5 16.25 17.2203 16.25 16.875C16.25 16.5297 16.5297 16.25 16.875 16.25H16.8758C16.8758 15.9047 17.1555 15.625 17.5008 15.625C17.8453 15.625 18.125 15.9047 18.125 16.25C18.125 16.9391 17.5641 17.5 16.875 17.5Z"
                                    fill="black" />
                                <path
                                    d="M16.875 17.5H3.125C2.77968 17.5 2.5 17.2203 2.5 16.875C2.5 16.5297 2.77968 16.25 3.125 16.25H16.875C17.2203 16.25 17.5 16.5297 17.5 16.875C17.5 17.2203 17.2203 17.5 16.875 17.5Z"
                                    fill="black" />
                                <path
                                    d="M3.125 17.5C2.43594 17.5 1.875 16.9391 1.875 16.25C1.875 15.9047 2.15468 15.625 2.5 15.625C2.84532 15.625 3.125 15.9047 3.125 16.25V16.2508C3.47032 16.2508 3.75 16.5305 3.75 16.8758C3.75 17.2203 3.47032 17.5 3.125 17.5Z"
                                    fill="black" />
                                <path
                                    d="M17.5 11.25H12.5C12.1547 11.25 11.875 10.9703 11.875 10.625C11.875 10.2797 12.1547 10 12.5 10H17.5C17.8453 10 18.125 10.2797 18.125 10.625C18.125 10.9703 17.8453 11.25 17.5 11.25Z"
                                    fill="black" />
                                <path
                                    d="M7.5 11.25H2.5C2.15468 11.25 1.875 10.9703 1.875 10.625C1.875 10.2797 2.15468 10 2.5 10H7.5C7.84532 10 8.125 10.2797 8.125 10.625C8.125 10.9703 7.84532 11.25 7.5 11.25Z"
                                    fill="black" />
                                <path
                                    d="M10 13.75C8.30624 13.75 6.875 12.3188 6.875 10.625C6.875 10.2797 7.15468 10 7.5 10C7.84532 10 8.125 10.2797 8.125 10.625C8.125 11.6414 8.9836 12.5 10 12.5C11.0164 12.5 11.875 11.6414 11.875 10.625C11.875 10.2797 12.1547 10 12.5 10C12.8453 10 13.125 10.2797 13.125 10.625C13.125 12.3188 11.6938 13.75 10 13.75Z"
                                    fill="black" />
                            </svg>
                            incoming <span>(<span id="unread-received-count">0</span> unread)</span>
                        </div>
                        {% comment %} outgoing {% endcomment %}
                        <div class="com-pkg-tab-item" data-tab="com-pkg-telephony-outgoing">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path
                                    d="M17.4062 3.12504C17.2406 2.93051 16.9734 2.85628 16.7312 2.93754L2.8688 7.63134C2.59926 7.72587 2.42896 7.9915 2.45396 8.27588C2.47896 8.56026 2.69302 8.7915 2.97506 8.8376H3.16256C4.99068 9.05166 6.66576 9.9626 7.83916 11.3806C9.0126 12.7986 9.59384 14.6142 9.4626 16.4502C9.45323 16.7424 9.64776 17.0025 9.93136 17.0752H10.0876C10.3204 17.0768 10.5345 16.9494 10.6439 16.744L17.5001 3.82516C17.6165 3.5947 17.5789 3.31644 17.4062 3.12504ZM10.5312 14.2938C10.2773 12.8954 9.65854 11.5884 8.73744 10.5056C7.81712 9.42204 6.62644 8.60174 5.28744 8.12524L15.625 4.62524L10.5312 14.2938Z"
                                    fill="#212429" />
                            </svg>
                            outgoing
                        </div>
                      
                    </div>
                </div>
                {% comment %} telephony tabs {% endcomment %}
                <div style="width: 100%">
                    <div id="com-pkg-telephony-incoming" class="com-pkg-individual-tab-content active">
                        <table id="com-pkg-telephony-incoming-table" class="display" style="width: 100%"></table>
                    </div>
                    <div id="com-pkg-telephony-outgoing" class="com-pkg-individual-tab-content">
                        <table id="com-pkg-telephony-outgoing-table" class="display" style="width: 100%"></table>
                    </div>

                    {% comment %} <div id="com-pkg-email-drafts" class="com-pkg-individual-tab-content">
                        <div class="com-pkg-search-box">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none">
                                <path
                                    d="M10.4155 4.03223C6.81552 4.03223 3.86328 6.98447 3.86328 10.5845C3.86328 14.1845 6.81552 17.1367 10.4155 17.1367C11.6399 17.1367 12.7911 16.8011 13.7755 16.2011L18.191 20.3533C18.5267 20.6655 19.0788 20.6655 19.391 20.3055L19.5589 20.1133C19.871 19.7777 19.871 19.2255 19.511 18.9133L15.2875 14.9524C16.3197 13.8002 16.9675 12.2646 16.9675 10.5846C16.9675 6.98461 14.0153 4.03237 10.4153 4.03237L10.4155 4.03223ZM10.4155 5.92784C12.9833 5.92784 15.071 7.99223 15.071 10.5834C15.071 13.1756 13.0067 15.2389 10.4155 15.2389C7.82424 15.2398 5.76 13.1754 5.76 10.5841C5.76 8.01536 7.84781 5.9276 10.4155 5.9276V5.92784Z"
                                    fill="#495057" />
                            </svg>
                            <input placeholder="Search in received" class="com-pkg-search-input"
                                id="com-pkg-email-draft-search-input" />
                        </div>
                        <table id="com-pkg-email-draft-table" class="display" style="width: 100%">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div> {% endcomment %}

                </div>
            </div>

            <div  id="com-pkg-video-call-tab" class="com-pkg-tab-content">
                <div style="border-right: 1px solid #DDE2E5; width:20%; height: 100%">
                    <div class="com-pkg-label">Video Call</div>
                    <div class="com-pkg-cta-btn" id="new-call-btn" data-bs-toggle="offcanvas"
                        data-bs-target="#com-pkg-cta-video-call-modal" aria-controls="com-pkg-cta-video-call-modal">
                        <div class="com-pkg-cta-btn-text">New Call</div>
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                            <path
                                d="M16.4225 0.590835C15.604 -0.196945 14.3145 -0.196945 13.4951 0.590835L12.0296 2.06227L5.95743 8.17013C5.6935 8.43734 5.50546 8.77136 5.41404 9.1375L4.81027 11.5669C4.7059 11.9807 4.79733 12.4197 5.05695 12.7572C5.31658 13.0947 5.71679 13.2925 6.14116 13.2951C6.25588 13.2951 6.36974 13.2804 6.48101 13.2526L8.89619 12.6453C9.25931 12.5533 9.59224 12.3642 9.85706 12.097L15.9293 5.98911L17.3938 4.51681C18.202 3.70386 18.202 2.38599 17.3938 1.57304L16.4225 0.590835ZM8.88482 11.1157C8.79598 11.2042 8.68558 11.2675 8.56483 11.2979L6.14964 11.9061L6.75428 9.47668C6.78446 9.35435 6.84656 9.24329 6.93454 9.15394L12.5194 3.53716L14.4713 5.49964L8.88482 11.1157ZM16.4225 3.5346L15.4453 4.51585L13.4934 2.55337L14.4698 1.57211C14.7423 1.30923 15.1727 1.30923 15.4453 1.57211L16.4225 2.55337C16.6917 2.82407 16.6916 3.2639 16.4225 3.5346Z"
                                fill="white" />
                            <path
                                d="M3.45011 18H13.1104C14.0247 17.9991 14.9019 17.633 15.5488 16.9823C16.1957 16.3316 16.5597 15.4492 16.5605 14.5296V8.01216C16.5605 7.62868 16.2518 7.31809 15.8705 7.31809C15.4893 7.31809 15.1805 7.62868 15.1805 8.01216V14.5296C15.1805 15.6791 14.2533 16.6118 13.1104 16.6118H3.45011C2.30726 16.6118 1.38005 15.6791 1.38005 14.5296V4.81254C1.38005 3.66297 2.30726 2.73031 3.45011 2.73031H10.1019C10.4832 2.73031 10.792 2.41972 10.792 2.03624C10.792 1.65275 10.4832 1.34216 10.1019 1.34216H3.45011C2.53584 1.34303 1.65864 1.70915 1.01174 2.35984C0.36484 3.01054 0.000861148 3.89287 0 4.81254V14.5296C0.000862473 15.4492 0.36484 16.3316 1.01174 16.9823C1.65864 17.633 2.53582 17.9991 3.45011 18Z"
                                fill="white" />
                        </svg>
                    </div>

                    <div class="com-pkg-video-call-tabs" style="margin-top:24px;">
                        {% comment %} incoming {% endcomment %}
                        <div class="com-pkg-tab-item active" data-tab="com-pkg-video-call-incoming">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"
                                fill="none">
                                <path
                                    d="M2.5 16.875C2.15468 16.875 1.875 16.5953 1.875 16.25V3.75C1.875 3.40468 2.15468 3.125 2.5 3.125C2.84532 3.125 3.125 3.40468 3.125 3.75V16.25C3.125 16.5953 2.84532 16.875 2.5 16.875Z"
                                    fill="black" />
                                <path
                                    d="M17.5 16.875C17.1547 16.875 16.875 16.5953 16.875 16.25V3.75C16.875 3.40468 17.1547 3.125 17.5 3.125C17.8453 3.125 18.125 3.40468 18.125 3.75V16.25C18.125 16.5953 17.8453 16.875 17.5 16.875Z"
                                    fill="black" />
                                <path
                                    d="M2.5 4.375C2.15468 4.375 1.875 4.09532 1.875 3.75C1.875 3.06094 2.43594 2.5 3.125 2.5C3.47032 2.5 3.75 2.77968 3.75 3.125C3.75 3.47032 3.47032 3.75 3.125 3.75H3.12422C3.12422 4.09532 2.84532 4.375 2.5 4.375Z"
                                    fill="black" />
                                <path
                                    d="M16.875 3.75H3.125C2.77968 3.75 2.5 3.47032 2.5 3.125C2.5 2.77968 2.77968 2.5 3.125 2.5H16.875C17.2203 2.5 17.5 2.77968 17.5 3.125C17.5 3.47032 17.2203 3.75 16.875 3.75Z"
                                    fill="black" />
                                <path
                                    d="M17.5 4.375C17.1547 4.375 16.875 4.09532 16.875 3.75V3.74922C16.5297 3.74922 16.25 3.46954 16.25 3.12422C16.25 2.77968 16.5297 2.5 16.875 2.5C17.5641 2.5 18.125 3.06094 18.125 3.75C18.125 4.09532 17.8453 4.375 17.5 4.375Z"
                                    fill="black" />
                                <path
                                    d="M16.875 17.5C16.5297 17.5 16.25 17.2203 16.25 16.875C16.25 16.5297 16.5297 16.25 16.875 16.25H16.8758C16.8758 15.9047 17.1555 15.625 17.5008 15.625C17.8453 15.625 18.125 15.9047 18.125 16.25C18.125 16.9391 17.5641 17.5 16.875 17.5Z"
                                    fill="black" />
                                <path
                                    d="M16.875 17.5H3.125C2.77968 17.5 2.5 17.2203 2.5 16.875C2.5 16.5297 2.77968 16.25 3.125 16.25H16.875C17.2203 16.25 17.5 16.5297 17.5 16.875C17.5 17.2203 17.2203 17.5 16.875 17.5Z"
                                    fill="black" />
                                <path
                                    d="M3.125 17.5C2.43594 17.5 1.875 16.9391 1.875 16.25C1.875 15.9047 2.15468 15.625 2.5 15.625C2.84532 15.625 3.125 15.9047 3.125 16.25V16.2508C3.47032 16.2508 3.75 16.5305 3.75 16.8758C3.75 17.2203 3.47032 17.5 3.125 17.5Z"
                                    fill="black" />
                                <path
                                    d="M17.5 11.25H12.5C12.1547 11.25 11.875 10.9703 11.875 10.625C11.875 10.2797 12.1547 10 12.5 10H17.5C17.8453 10 18.125 10.2797 18.125 10.625C18.125 10.9703 17.8453 11.25 17.5 11.25Z"
                                    fill="black" />
                                <path
                                    d="M7.5 11.25H2.5C2.15468 11.25 1.875 10.9703 1.875 10.625C1.875 10.2797 2.15468 10 2.5 10H7.5C7.84532 10 8.125 10.2797 8.125 10.625C8.125 10.9703 7.84532 11.25 7.5 11.25Z"
                                    fill="black" />
                                <path
                                    d="M10 13.75C8.30624 13.75 6.875 12.3188 6.875 10.625C6.875 10.2797 7.15468 10 7.5 10C7.84532 10 8.125 10.2797 8.125 10.625C8.125 11.6414 8.9836 12.5 10 12.5C11.0164 12.5 11.875 11.6414 11.875 10.625C11.875 10.2797 12.1547 10 12.5 10C12.8453 10 13.125 10.2797 13.125 10.625C13.125 12.3188 11.6938 13.75 10 13.75Z"
                                    fill="black" />
                            </svg>
                            Meetings 
                        </div>
                 
                    </div>
                </div>
                {% comment %} telephony tabs {% endcomment %}
                <div style="width: 100%">
                    <div id="com-pkg-video-call-incoming" class="com-pkg-individual-tab-content active">
                        <table id="com-pkg-video-call-incoming-table" class="display" style="width: 100%"></table>
                    </div>

                    {% comment %} <div id="com-pkg-email-drafts" class="com-pkg-individual-tab-content">
                        <div class="com-pkg-search-box">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none">
                                <path
                                    d="M10.4155 4.03223C6.81552 4.03223 3.86328 6.98447 3.86328 10.5845C3.86328 14.1845 6.81552 17.1367 10.4155 17.1367C11.6399 17.1367 12.7911 16.8011 13.7755 16.2011L18.191 20.3533C18.5267 20.6655 19.0788 20.6655 19.391 20.3055L19.5589 20.1133C19.871 19.7777 19.871 19.2255 19.511 18.9133L15.2875 14.9524C16.3197 13.8002 16.9675 12.2646 16.9675 10.5846C16.9675 6.98461 14.0153 4.03237 10.4153 4.03237L10.4155 4.03223ZM10.4155 5.92784C12.9833 5.92784 15.071 7.99223 15.071 10.5834C15.071 13.1756 13.0067 15.2389 10.4155 15.2389C7.82424 15.2398 5.76 13.1754 5.76 10.5841C5.76 8.01536 7.84781 5.9276 10.4155 5.9276V5.92784Z"
                                    fill="#495057" />
                            </svg>
                            <input placeholder="Search in received" class="com-pkg-search-input"
                                id="com-pkg-email-draft-search-input" />
                        </div>
                        <table id="com-pkg-email-draft-table" class="display" style="width: 100%">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div> {% endcomment %}

                </div>
            </div>
        </div>

    </div>

    <div id="com-pkg-cta-email-modal" class="offcanvas offcanvas-end" tabindex="-1" aria-labelledby="com-pkg-cta-email-modal"
        style="width: 498px;  padding: 32px;">
        <div class="offcanvas-header" style="padding: 0;">
            <button type="button" class="modal-close" data-bs-dismiss="offcanvas" aria-label="Close"
                style="z-index: 10">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <g clip-path="url(#clip0_5158_6104)">
                        <path
                            d="M17.7213 1.22117L10.5168 8.42571C10.2219 8.72061 9.75409 8.72061 9.48417 8.42571L2.27865 1.22117C1.98375 0.926275 1.51593 0.926275 1.24601 1.22117C0.951112 1.51607 0.951112 1.9839 1.24601 2.25382L8.45153 9.45933C8.74643 9.75423 8.74643 10.2221 8.45153 10.492L1.22117 17.7213C0.926275 18.0162 0.926275 18.4841 1.22117 18.754C1.51607 19.0489 1.9839 19.0489 2.25382 18.754L9.45933 11.5485C9.75423 11.2536 10.2221 11.2536 10.492 11.5485L17.7213 18.7788C18.0162 19.0737 18.4841 19.0737 18.754 18.7788C19.0489 18.4839 19.0489 18.0161 18.754 17.7462L11.5736 10.5158C11.2787 10.2209 11.2787 9.7531 11.5736 9.48319L18.7791 2.27767C19.074 1.98277 19.074 1.51494 18.7791 1.24503C18.4842 0.950129 18.0173 0.950129 17.7214 1.22101L17.7213 1.22117Z"
                            fill="black" stroke="black" stroke-width="0.4" />
                    </g>
                    <defs>
                        <clipPath id="clip0_5158_6104">
                            <rect width="20" height="20" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            </button>
            <div class="modal-title">
                Compose email
            </div>
        </div>
        <h3 class="modal-title" style="margin-top: 32px;">
            {% comment %} {{add_btn_title}} btn {% endcomment %}
        </h3>
        <div class="offcanvas-body" style="padding: 0; position:relative;">


            <form id="com-pkg-send-email-form"
                style="height: 92%; overflow: auto; margin-block-end: 0; padding-bottom: 10px;">
                <div class="com-pkg-compose-form-fields-container" style="height: 100%">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="com-pkg-form-label">
                            To
                        </label>
                        <input type="email" id="com-pkg-compose-email-to" name="com-pkg-compose-email-to"
                            placeholder="Enter Recipient" class="com-pkg-form-input" />
                        <span id="com-pkg-email-validation" class="com-pkg-input-valid" style="display: none;">Please
                            enter valid email</span>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="com-pkg-form-label">
                            Subject
                        </label>
                        <input type="text" id="com-pkg-compose-email-subject" name="com-pkg-compose-email-subject"
                            placeholder="Enter Subject" class="com-pkg-form-input" />
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="com-pkg-form-label">
                            Message
                        </label>
                        {% comment %} <textarea rows="18" id="com-pkg-compose-email-textarea"
                            name="com-pkg-compose-email-textarea" placeholder="Enter"
                            class="com-pkg-form-input"></textarea> {% endcomment %}
                        <div id="com-pkg-compose-email-body" style="height: 400px !important; max-height: 400px;">
                            <p>Hello World!</p>
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="com-pkg-form-label" for="com-pkg-compose-email-attachment">
                            Attatchments
                            <div class="com-pkg-form-input"
                                style="display: flex; align-items: center; justify-content: space-between; border: 1px dashed;">
                                Click to Upload
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19"
                                    fill="none">
                                    <path
                                        d="M18.408 11.9034C18.7349 11.9034 19 12.1658 19 12.4895V14.6002C19 16.4776 17.4623 18 15.566 18H4.43404C2.53774 18 1 16.4776 1 14.6002V12.4895C1 12.1658 1.26509 11.9034 1.59204 11.9034C1.91899 11.9034 2.18408 12.1658 2.18408 12.4895V14.6002C2.18408 15.8302 3.19166 16.8278 4.43408 16.8278H15.566C16.8084 16.8278 17.816 15.8302 17.816 14.6002V12.4895C17.816 12.1658 18.081 11.9034 18.408 11.9034ZM9.99998 13.193C10.3136 13.193 10.5709 12.9515 10.5906 12.6459L10.592 12.6069V2.93564L13.1485 5.29759C13.3771 5.50921 13.73 5.50643 13.9557 5.29898L13.9853 5.26905C14.199 5.04281 14.1962 4.69335 13.9867 4.4699L13.9564 4.44066L10.4077 1.16131C10.3965 1.15087 10.3859 1.14182 10.3747 1.13208C10.3712 1.12999 10.3684 1.1272 10.3656 1.12511C10.3585 1.11954 10.3508 1.11397 10.3438 1.1091C10.3388 1.10562 10.3339 1.10214 10.3283 1.09866C10.3234 1.09518 10.3184 1.0917 10.3128 1.08891C10.3079 1.08543 10.303 1.08265 10.2973 1.07917C10.2896 1.07499 10.2819 1.07082 10.2734 1.06664L10.2643 1.06177C10.2573 1.05829 10.2495 1.05481 10.2425 1.05133C10.2369 1.04924 10.232 1.04715 10.227 1.04506C10.22 1.04228 10.2137 1.03949 10.2073 1.03671L10.1898 1.03114C10.1848 1.02905 10.1799 1.02766 10.1743 1.02627C10.1673 1.02418 10.1602 1.02209 10.1525 1.02C10.1335 1.01443 10.1131 1.01025 10.0934 1.00747C10.0885 1.00677 10.0829 1.00608 10.078 1.00538L10.0386 1.00121L9.99993 1.00051C9.9697 1.00051 9.93946 1.0026 9.90923 1.00677L9.88181 1.01165C9.7004 0.975448 9.50492 1.02348 9.35939 1.15783L5.80655 4.44074C5.56749 4.66142 5.55484 5.03244 5.77772 5.26912C6.00062 5.50579 6.37538 5.51832 6.61443 5.29766L9.40803 2.71652V12.607C9.40803 12.9307 9.67303 13.193 9.99998 13.193Z"
                                        fill="#A3ABB1" stroke="#A3ABB1" stroke-width="0.3" />
                                </svg>
                                <input type="file" multiple id="com-pkg-compose-email-attachment"
                                    name="com-pkg-compose-email-attachment" hidden placeholder="Enter recipients" />
                            </div>
                        </label>

                        <div id="attachments-list">
                        </div>
                    </div>
                </div>


            </form>
            <div class="btns" style="display: flex; gap: 12px; position: absolute; width:100%; bottom: 0;">
                <button id="com-pkg-save-draft" class="com-pkg-form-btns"
                    style="flex-grow: 1; border: 1px solid var(--primary-color); color: var(--primary-color);">
                    Save as Draft
                </button>
                <button id="com-pkg-send-email" class="com-pkg-form-btns"
                    style="flex-grow: 8; background-color: var(--primary-color); color: #fff;">
                    Send
                </button>
            </div>


        </div>

    </div>

    <div id="com-pkg-cta-sms-modal" class="offcanvas offcanvas-end" tabindex="-1" aria-labelledby="com-pkg-cta-sms-modal"
        style="width: 498px;  padding: 32px;">
        <div class="offcanvas-header" style="padding: 0;">
            <button type="button" class="modal-close" data-bs-dismiss="offcanvas" aria-label="Close"
                style="z-index: 10">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <g clip-path="url(#clip0_5158_6104)">
                        <path
                            d="M17.7213 1.22117L10.5168 8.42571C10.2219 8.72061 9.75409 8.72061 9.48417 8.42571L2.27865 1.22117C1.98375 0.926275 1.51593 0.926275 1.24601 1.22117C0.951112 1.51607 0.951112 1.9839 1.24601 2.25382L8.45153 9.45933C8.74643 9.75423 8.74643 10.2221 8.45153 10.492L1.22117 17.7213C0.926275 18.0162 0.926275 18.4841 1.22117 18.754C1.51607 19.0489 1.9839 19.0489 2.25382 18.754L9.45933 11.5485C9.75423 11.2536 10.2221 11.2536 10.492 11.5485L17.7213 18.7788C18.0162 19.0737 18.4841 19.0737 18.754 18.7788C19.0489 18.4839 19.0489 18.0161 18.754 17.7462L11.5736 10.5158C11.2787 10.2209 11.2787 9.7531 11.5736 9.48319L18.7791 2.27767C19.074 1.98277 19.074 1.51494 18.7791 1.24503C18.4842 0.950129 18.0173 0.950129 17.7214 1.22101L17.7213 1.22117Z"
                            fill="black" stroke="black" stroke-width="0.4" />
                    </g>
                    <defs>
                        <clipPath id="clip0_5158_6104">
                            <rect width="20" height="20" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            </button>
            <div class="modal-title">
                New SMS
            </div>
        </div>
        <h3 class="modal-title" style="margin-top: 32px;">
            {% comment %} {{add_btn_title}} btn {% endcomment %}
        </h3>
        <div class="offcanvas-body" style="padding: 0; position:relative;">


            <form id="com-pkg-sms-form"
                style="height: 92%; overflow: auto; margin-block-end: 0; padding-bottom: 10px;">
                <div class="com-pkg-compose-form-fields-container" style="height: 100%">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="com-pkg-form-label" for="com-pkg-compose-sms-to">
                            To
                        </label>
                        <input id="com-pkg-sms-to" type="number" name="com-pkg-compose-sms-to"
                            placeholder="Enter Number" class="com-pkg-form-input" />
                        <span id="com-pkg-sms-to" class="com-pkg-input-valid" style="display: none;">Please
                            enter valid number</span>
                    </div>

                    

                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="com-pkg-form-label">
                            Message
                        </label>
                        <textarea rows="18" id="com-pkg-compose-sms-textarea"
                            name="com-pkg-compose-sms-textarea" placeholder="Enter"
                            class="com-pkg-form-input"></textarea>
                            <div id="com-pkg-sms-body" style="height: 400px !important; max-height: 400px;">
                          
                        </div>
                    </div>

                </div>


            </form>
            <div class="btns" style="display: flex; gap: 12px; position: absolute; width:100%; bottom: 0;">
                {% comment %} <button id="com-pkg-sms-draft" class="com-pkg-form-btns"
                    style="flex-grow: 1; border: 1px solid var(--primary-color); color: var(--primary-color);">
                    Save as Draft
                </button> {% endcomment %}
                <button id="com-pkg-send-sms" class="com-pkg-form-btns"
                    style="flex-grow: 8; background-color: var(--primary-color); color: #fff;">
                    Send
                </button>
            </div>


        </div>

    </div>
    
    <div id="com-pkg-cta-telephony-modal" class="offcanvas offcanvas-end" tabindex="-1" aria-labelledby="com-pkg-cta-telephony-modal"
        style="width: 498px;  padding: 32px;">
        <div class="offcanvas-header" style="padding: 0;">
            <button type="button" class="modal-close" data-bs-dismiss="offcanvas" aria-label="Close"
                style="z-index: 10">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <g clip-path="url(#clip0_5158_6104)">
                        <path
                            d="M17.7213 1.22117L10.5168 8.42571C10.2219 8.72061 9.75409 8.72061 9.48417 8.42571L2.27865 1.22117C1.98375 0.926275 1.51593 0.926275 1.24601 1.22117C0.951112 1.51607 0.951112 1.9839 1.24601 2.25382L8.45153 9.45933C8.74643 9.75423 8.74643 10.2221 8.45153 10.492L1.22117 17.7213C0.926275 18.0162 0.926275 18.4841 1.22117 18.754C1.51607 19.0489 1.9839 19.0489 2.25382 18.754L9.45933 11.5485C9.75423 11.2536 10.2221 11.2536 10.492 11.5485L17.7213 18.7788C18.0162 19.0737 18.4841 19.0737 18.754 18.7788C19.0489 18.4839 19.0489 18.0161 18.754 17.7462L11.5736 10.5158C11.2787 10.2209 11.2787 9.7531 11.5736 9.48319L18.7791 2.27767C19.074 1.98277 19.074 1.51494 18.7791 1.24503C18.4842 0.950129 18.0173 0.950129 17.7214 1.22101L17.7213 1.22117Z"
                            fill="black" stroke="black" stroke-width="0.4" />
                    </g>
                    <defs>
                        <clipPath id="clip0_5158_6104">
                            <rect width="20" height="20" fill="white" />
                        </clipPath>
                    </defs>
                </svg>
            </button>
            <div class="modal-title">
                New Call
            </div>
        </div>
        <h3 class="modal-title" style="margin-top: 32px;">
            {% comment %} {{add_btn_title}} btn {% endcomment %}
        </h3>
        <div class="offcanvas-body" style="padding: 0; position:relative;">


            <form id="com-pkg-call-form"
                style="height: 92%; overflow: auto; margin-block-end: 0; padding-bottom: 10px;">
                <div class="com-pkg-compose-form-fields-container" style="height: 100%">
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label class="com-pkg-form-label" for="com-pkg-compose-sms-to">
                            To
                        </label>
                        <input id="com-pkg-audio-call-to" type="number" name="com-pkg-audio-call-to"
                            placeholder="Enter Number" class="com-pkg-form-input" />
                        <span id="com-pkg-audio-call-to-error" class="com-pkg-input-valid" style="display: none;">Please
                            enter valid number</span>
                    </div>

                </div>


            </form>
            <div class="btns" style="display: flex; gap: 12px; position: absolute; width:100%; bottom: 0;">
                {% comment %} <button id="com-pkg-sms-draft" class="com-pkg-form-btns"
                    style="flex-grow: 1; border: 1px solid var(--primary-color); color: var(--primary-color);">
                    Save as Draft
                </button> {% endcomment %}

                <button id="com-pkg-audio-call" class="com-pkg-form-btns"
                    style="flex-grow: 8; background-color: var(--primary-color); color: #fff;">
                    Call
                </button>
            </div>


        </div>

    </div>

    <div class="offcanvas offcanvas-end detail-view-modal" id="email-detail-view-modal" data-bs-backdrop="false" tabindex="-1"
    style="width: 100%; height:100%; overflow:auto; padding:0; position: absolute;"
    aria-labelledby="email-detail-view-modal">
            
                <div class="offcanvas-header">
                    <div class="d-flex align-items-center" id="close-email-detail-view" aria-label="Close"
                        style="gap: 8px; cursor: pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="12" viewBox="0 0 8 12" fill="none">
                            <path
                                d="M7.59955 9.95935L3.19999 5.99957L7.59955 2.03979C8.13325 1.55943 8.13325 0.839473 7.59955 0.360268C7.06584 -0.120089 6.26592 -0.120089 5.7335 0.360268L0.400279 5.16038C-0.133426 5.64074 -0.133426 6.3607 0.400279 6.83991L5.7335 11.64C5.99972 11.8796 6.2672 12 6.66716 12C7.06712 12 7.33333 11.8796 7.60083 11.64C8.13328 11.1597 8.13326 10.4397 7.59955 9.95935Z"
                                fill="black" />
                        </svg>
                        Back
                    </div>
                </div>
           
            <div class="offcanvas-body" style="padding: 0px 40px;" >
                <div class="com-pkg-email-heading">
                    Introduction: I needed to know more info on the last discussion we had!
                </div>

                <div style="width: 100%; margin-bottom: 24px; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
                    <div class="com-pkg-email-contact-sender">
                        <div class="com-pkg-email-details-label">From: Cameron Williamson</div>
                        <div class="com-pkg-email-detail-label-gray"> &lt;cameron.williamson@email.com&gt;</div>
                    </div>
                    <div class="com-pkg-email-contact-sender">
                        <div class="com-pkg-email-details-label">Cc:</div>
                        <div style="flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 4px; display: inline-flex">
                            <div class="com-pkg-email-contact-sender">
                                <div class="com-pkg-email-details-label">Dianne Russell</div>
                                <div class="com-pkg-email-detail-label-gray"> &lt;dianne.russell@email.com&gt; </div>
                            </div>
                            <div class="com-pkg-email-contact-sender">
                                <div class="com-pkg-email-details-label">Jenny Wilson</div>
                                <div class="com-pkg-email-detail-label-gray"> &lt;jenny.wilson@email.com&gt; </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="width: 100%; justify-content: flex-start; align-items: flex-start; gap: 12px; display: inline-flex">
                    <div style="padding-left: 12px; padding-right: 12px; padding-top: 8px; padding-bottom: 8px; border-radius: 6px; border: 1px #DDE2E5 solid; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
                        <div style="justify-content: flex-start; align-items: flex-start; gap: 12px; display: inline-flex">
                            <div style="width: 18px; height: 18px; position: relative">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path d="M4.44011 4.91994C2.18824 4.91994 0.360107 6.74807 0.360107 8.99994C0.360107 11.2518 2.18824 13.0799 4.44011 13.0799H13.5601C13.6885 13.0818 13.8123 13.0321 13.9042 12.9421C13.9951 12.8512 14.0467 12.7284 14.0467 12.5999C14.0467 12.4715 13.9951 12.3487 13.9042 12.2577C13.8123 12.1677 13.6885 12.1181 13.5601 12.1199H4.44011C2.70292 12.1199 1.32011 10.7371 1.32011 8.99993C1.32011 7.26274 2.70292 5.87993 4.44011 5.87993H14.6401C15.7782 5.87993 16.6801 6.7818 16.6801 7.91993C16.6801 9.05806 15.7782 9.95993 14.6401 9.95993H4.68011C4.14011 9.95993 3.72011 9.53993 3.72011 8.99993C3.72011 8.45993 4.14011 8.03993 4.68011 8.03993H9.00011C9.12855 8.04181 9.2523 7.99212 9.34417 7.90212C9.43511 7.81118 9.48667 7.68837 9.48667 7.55993C9.48667 7.43148 9.43511 7.30867 9.34417 7.21773C9.2523 7.12773 9.12855 7.07805 9.00011 7.07992H4.68011C3.62449 7.07992 2.76011 7.94431 2.76011 8.99992C2.76011 10.0555 3.62449 10.9199 4.68011 10.9199H14.6401C16.2939 10.9199 17.6401 9.57367 17.6401 7.91992C17.6401 6.26618 16.2939 4.91992 14.6401 4.91992L4.44011 4.91994Z" fill="black"/>
                                </svg>                            
                            </div>
                            <div style="color: #212429; font-size: 14px; font-family: Lato; font-weight: 400; line-height: 20px; letter-spacing: 0.20px; word-wrap: break-word">File name1</div>
                        </div>
                    </div>
                    <div style="padding-left: 12px; padding-right: 12px; padding-top: 8px; padding-bottom: 8px; border-radius: 6px; border: 1px #DDE2E5 solid; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
                        <div style="justify-content: flex-start; align-items: flex-start; gap: 12px; display: inline-flex">
                            <div style="width: 18px; height: 18px; position: relative">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                                    <path d="M4.44011 4.91994C2.18824 4.91994 0.360107 6.74807 0.360107 8.99994C0.360107 11.2518 2.18824 13.0799 4.44011 13.0799H13.5601C13.6885 13.0818 13.8123 13.0321 13.9042 12.9421C13.9951 12.8512 14.0467 12.7284 14.0467 12.5999C14.0467 12.4715 13.9951 12.3487 13.9042 12.2577C13.8123 12.1677 13.6885 12.1181 13.5601 12.1199H4.44011C2.70292 12.1199 1.32011 10.7371 1.32011 8.99993C1.32011 7.26274 2.70292 5.87993 4.44011 5.87993H14.6401C15.7782 5.87993 16.6801 6.7818 16.6801 7.91993C16.6801 9.05806 15.7782 9.95993 14.6401 9.95993H4.68011C4.14011 9.95993 3.72011 9.53993 3.72011 8.99993C3.72011 8.45993 4.14011 8.03993 4.68011 8.03993H9.00011C9.12855 8.04181 9.2523 7.99212 9.34417 7.90212C9.43511 7.81118 9.48667 7.68837 9.48667 7.55993C9.48667 7.43148 9.43511 7.30867 9.34417 7.21773C9.2523 7.12773 9.12855 7.07805 9.00011 7.07992H4.68011C3.62449 7.07992 2.76011 7.94431 2.76011 8.99992C2.76011 10.0555 3.62449 10.9199 4.68011 10.9199H14.6401C16.2939 10.9199 17.6401 9.57367 17.6401 7.91992C17.6401 6.26618 16.2939 4.91992 14.6401 4.91992L4.44011 4.91994Z" fill="black"/>
                                </svg>                            
                            </div>
                            <div style="color: #212429; font-size: 14px; font-family: Lato; font-weight: 400; line-height: 20px; letter-spacing: 0.20px; word-wrap: break-word">File name2</div>
                        </div>
                    </div>
                </div>
                <div class="attatchement-label">
                    2 attachments
                </div>
                <div class="email-detail-divider">
                <div style="color: #212429;font-size: 14px; line-height: 20px; letter-spacing: 0.20px; word-wrap: break-word; margin-top: 24px; "> Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. 

                    Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? 

                    Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatu.

                    Thank you!</div>
                                    {% comment %} <div style="width: 100%; color: #212429; font-size: 14px; font-family: Lato; font-weight: 400; line-height: 20px; letter-spacing: 0.20px; word-wrap: break-word">Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. <br/><br/>Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? <br/><br/>Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatu.<br/><br/>Thank you!</div> {% endcomment %}
                                    </div>
                                    {% comment %} timeline appeded using jquery (check with id) {% endcomment %}
                                </div>
        
    </div>
</body>

{% comment %} Theme handling {% endcomment %}
<script>
    var csrf_token = "{{ csrf_token }}";
    let csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

    {% comment %} const config = {{ frame_config| safe}};
    const app_theme_config = {{ app_theme_config| safe}}; {% endcomment %}

    let app_theme_config = {
        "color": {
            "primary": "#58B19F",
            "secondary": "#343E3D",
            "background": "#ffffff"
        },
        "button": {
            "color": "#ffffff",
            "background": "#58B19F",
            "border_color": "#C7CED3",
            "border_radius": "10"
        },
        "typography": {
            "font_family": "Open Sans"
        }
    }

    let config = {
        "menu": [],
        "config": {
            "color": {
                "accent": "#DDE2E5",
                "header": "#FFFFFF",
                "primary": "#5048ED",
                "sidebar": "#343E3D",
                "secondary": "#343E3D",
                "background": "#FFFFFF",
                "typography": "#212429",
                "headerBorder": "#DDE2E5"
            }
        },
        "profile": {
            "name": "AnonymousUsers",
            "roles": [],
            "current_role": "AnonymousUsers"
        },
        "logo": null,
        "fav_icon": null
    }

    let newAppThemeConfig = {
        "color": {
            "accent": app_theme_config?.color?.primary || config?.config?.color?.primary || "#DDE2E5",
            "header": "#FFFFFF",
            "primary": app_theme_config?.color?.primary || config?.config?.color?.primary || "#DDE2E5",
            "sidebar": app_theme_config?.color?.secondary || config?.config?.color?.secondary || "#E1D6AE",
            "secondary": app_theme_config?.color?.secondary || config?.config?.color?.secondary || "#E1D6AE",
            "background": app_theme_config?.color?.background || config?.config?.color?.background || "#FFFFFF",
            "typography": "#212429",
            "headerBorder": "#DDE2E5"
        }
    }

    let newAppConfig = { ...config, "config": newAppThemeConfig };

    const root = document.querySelector(':root');
    const setCssVariables = vars => Object.entries(vars).forEach(v => root.style.setProperty(v[0], v[1]));
    const crudCssVariables = {
        "--primary-color": tinycolor
            .mix(
                tinycolor(
                    newAppConfig?.config?.color?.primary
                ).toHexString(),
                "#FFFFFF",
                9
            )
            .toHexString() || "#DDE2E5",
        "--secondary-color": tinycolor(newAppConfig?.config?.color?.secondary).toHexString() || "#E1D6AE",
        "--accent-color": tinycolor(newAppConfig?.config?.color?.accent).toHexString() || "#DDE2E5",
        "--background-color": tinycolor(newAppConfig?.config?.color?.background).toHexString() || "#FFFFFF",
        "--typography-color": tinycolor(newAppConfig?.config?.color?.typography).toHexString() || "#212429",
        "--top-navbar-color": tinycolor(newAppConfig?.config?.color?.header).isLight() ? tinycolor(
            newAppConfig?.config?.color?.typography
        ).toHexString() || "#212429"
            : "#FFFFFF",
        "--top-navbar-background-color": tinycolor(newAppConfig?.config?.color?.header).toHexString() || "#FFFFFF",
        "--top-navbar-border-color": tinycolor(newAppConfig?.config?.color?.headerBorder).toHexString() || "#DDE2E5",
        "--side-navbar-color": tinycolor(newAppConfig?.config?.color?.sidebar).isLight() ? tinycolor(newAppConfig?.config?.color?.typography).toHexString() || "#212429" : "#FFFFFF",
        "--side-navbar-background-color": tinycolor(newAppConfig?.config?.color?.sidebar).toHexString() || "#E1D6AE",
        "--side-navbar-hover-background-color": tinycolor(newAppConfig?.config?.color?.sidebar).isLight()
            ? tinycolor
                .mix(
                    tinycolor(
                        newAppConfig?.config?.color?.sidebar
                    ).toHexString(),
                    "#000000",
                    6
                )
                .toHexString() || "#E1D6AE"
            : tinycolor
                .mix(
                    tinycolor(
                        newAppConfig?.config?.color?.sidebar
                    ).toHexString(),
                    "#FFFFFF",
                    6
                )
                .toHexString() || "#FFFFFF",
    };
    setCssVariables(crudCssVariables);
</script>


<script>
    $(document).ready(function () {
        var inputElements = document.getElementsByName('csrfmiddlewaretoken');
        let csrf_token = inputElements[0].value;

        $(document)
            .find(".com-pkg-menu-item")
            .on("click", function () {
                // Remove the 'active' class from all menu items and tab contents
                $(".com-pkg-menu-item").removeClass("active");
                $(".com-pkg-tab-content").removeClass("active");

                $(".com-pkg-tab-item").removeClass("active");
                $(".com-pkg-individual-tab-content").removeClass("active");

                $("#com-pkg-email-tab .com-pkg-tab-item:first").addClass("active")
                $("#com-pkg-email-tab .com-pkg-individual-tab-content:first").addClass("active")

                $("#com-pkg-sms-tab .com-pkg-tab-item:first").addClass("active")
                $("#com-pkg-sms-tab .com-pkg-individual-tab-content:first").addClass("active")

                $("#com-pkg-Telephoney-tab .com-pkg-tab-item:first").addClass("active")
                $("#com-pkg-Telephoney-tab .com-pkg-individual-tab-content:first").addClass("active")

                $("#com-pkg-video-call-tab .com-pkg-tab-item:first").addClass("active")
                $("#com-pkg-video-call-tab .com-pkg-individual-tab-content:first").addClass("active")

                // Add the 'active' class to the clicked menu item
                $(this).addClass("active");

                // Get the associated tab ID from the 'data-tab' attribute
                var tabId = $(this).data("tab");

                console.log("tabId", tabId)

                // Add the 'active' class to the corresponding tab content
                $("#" + tabId).addClass("active");
            });

        $(document)
            .find(".com-pkg-tab-item")
            .on("click", function () {

                // Remove the 'active' class from all menu items and tab contents
                $(".com-pkg-tab-item").removeClass("active");
                $(".com-pkg-individual-tab-content").removeClass("active");

                // Add the 'active' class to the clicked menu item
                $(this).addClass("active");

                // Get the associated tab ID from the 'data-tab' attribute
                var tabId = $(this).data("tab");

                console.log("tabId", tabId)

                // Add the 'active' class to the corresponding tab content
                $("#" + tabId).addClass("active");


            });


    })
</script>
{% comment %}
<script type="text/javascript" src="{% zstatic 'plugins/communication/script.js' %}"></script> {% endcomment %}
<script>

    function ZToast(type, title, message, duration){
            $.toast({
            text : `<div class="z-toast-node ${{"error": "z-toast-error", "success": "z-toast-success", "warning": "z-toast-warning"}[type]}">
                    <h3 class="title">
                        ${title}
                    </h3>
                    <span class="message">
                        ${message}
                    </span>
                </div>`,
            hideAfter : duration,
            });

            
            $(document).find(".jq-toast-single").find(".close-jq-toast-single").html(`<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="Icon/Navigation/16px/Close" clip-path="url(#clip0_1917_1245)">
                <path id="Vector" d="M10.5041 0.879019L6.30147 5.08166C6.12945 5.25369 5.85655 5.25369 5.6991 5.08166L1.49588 0.879019C1.32386 0.706994 1.05096 0.706994 0.893507 0.879019C0.721482 1.05104 0.721482 1.32394 0.893507 1.48139L5.09673 5.68461C5.26875 5.85664 5.26875 6.12953 5.09673 6.28699L0.879019 10.5041C0.706994 10.6761 0.706994 10.949 0.879019 11.1065C1.05104 11.2785 1.32394 11.2785 1.48139 11.1065L5.68461 6.90327C5.85664 6.73125 6.12954 6.73125 6.28699 6.90327L10.5041 11.121C10.6761 11.293 10.949 11.293 11.1065 11.121C11.2785 10.949 11.2785 10.6761 11.1065 10.5186L6.91791 6.3009C6.74588 6.12887 6.74588 5.85598 6.91791 5.69853L11.1211 1.49531C11.2932 1.32328 11.2932 1.05038 11.1211 0.892933C10.9491 0.720908 10.6768 0.720908 10.5042 0.878924L10.5041 0.879019Z" fill="#6C747D" stroke="#6C747D" stroke-width="0.4"/>
                </g>
                <defs>
                <clipPath id="clip0_1917_1245">
                <rect width="12" height="12" fill="white"/>
                </clipPath>
                </defs>
                </svg>
            `);
        }

    let MockData = [
        {
            "name": "Cameron Williamson",
            "subject": "Introduction: I needed to know more info...",
            "message": "Sed ut perspiciatis unde omnis iste natus error sit voluptatem ...",
            "time": "2 min ago",
            "isSeen": true
        },
        {
            "name": "Dianne Russell",
            "subject": "Looking for discount on my next dose",
            "message": "Sed ut perspiciatis unde omnis iste natus error sit voluptatem ...",
            "time": "2 hrs ago",
            "isSeen": true
        },
        {
            "name": "Jenny Wilson",
            "subject": "How should I enrol into the program",
            "message": "Sed ut perspiciatis unde omnis iste natus error sit voluptatem ...",
            "time": "2:30 AM",
            "isSeen": true
        },
        {
            "name": "Albert Flores",
            "subject": "Here goes my details for KYC",
            "message": "Sed ut perspiciatis unde omnis iste natus error sit voluptatem ...",
            "time": "2:30 AM",
            "isSeen": true
        },
        {
            "name": "John Doe",
            "subject": "Regarding your recent inquiry",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis nec justo odio.",
            "time": "1 day ago",
            "isSeen": true
        },
        {
            "name": "Alice Johnson",
            "subject": "Confirmation for your order",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
            "time": "3 hrs ago",
            "isSeen": false
        },
        {
            "name": "Bob Smith",
            "subject": "Meeting schedule for next week",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.",
            "time": "Yesterday",
            "isSeen": false
        },
        {
            "name": "Mary Johnson",
            "subject": "Important announcement: Policy update",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque convallis tincidunt est, in fringilla elit finibus et.",
            "time": "5 hrs ago",
            "isSeen": false
        },
        {
            "name": "David Miller",
            "subject": "Re: Your job application",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed quis justo ac tortor fermentum accumsan.",
            "time": "1 week ago",
            "isSeen": false
        },
        {
            "name": "Emily Davis",
            "subject": "Upcoming event details",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce euismod nulla vitae fermentum ullamcorper.",
            "time": "2 days ago",
            "isSeen": false
        },
        {
            "name": "Michael Anderson",
            "subject": "Invoice for your recent purchase",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin ac purus feugiat, tristique mauris id, efficitur sapien.",
            "time": "1 hour ago",
            "isSeen": false
        },
        {
            "name": "Susan Taylor",
            "subject": "Feedback on our services",
            "message": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean vel tortor nec mauris fringilla bibendum.",
            "time": "3 days ago",
            "isSeen": false
        }
    ]
    let opendDraftMail
    let attatchmentsList

    var quill = new Quill('#com-pkg-compose-email-body', {
        theme: 'snow',
        placeholder: 'Enter email body',
    });

    quill.enable();


    function validateForm() {
        // Simple validation example (add more checks as needed)
        var subject = $('#com-pkg-compose-email-subject').val();
        var email = $('#com-pkg-compose-email-to').val();

        if (subject.trim() === '') {
            alert('subject it empty');
        }

        if (email.trim() === '' || !isValidEmail(email)) {
            return false;
        }

        return true;
    }

    function isValidEmail(email) {
        // Basic email validation (you may want to use a more robust method)
        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    {% comment %} handle email detali view here {% endcomment %}
    const emailDetailViewModal = document.getElementById("email-detail-view-modal")
    var emailOffcanvas = new bootstrap.Offcanvas(emailDetailViewModal);
    function handleEmailDetailView() {
        
        emailOffcanvas.show();


        fetch(`./api/?action=mark_read&pk=1`, {
                    method: "POST",
                    headers: {
                        'X-CSRFToken': "{{csrf_token|safe}}"
                    },
                })
                    .then((response) => response.json())
                    .then((responseData) => {
                        console.log("response", responseData)
                    });
    }

    $("#close-email-detail-view").on("click", function () {
        emailOffcanvas.hide();
    })

    {% comment %} $("#com-pkg-email-received-table tbody").append {% endcomment %}

    let emailReceivedTable = $('#com-pkg-email-received-table').DataTable({
        responsive: true,
        ordering: false,
        info: false,
        paging: true,
        pagingType: "input",
        scrollX: true,
        processing: true,
        serverSide: true,
        order: [],
        language: {
            info: "Showing: _START_-_END_/_TOTAL_ entries",
            lengthMenu:
                'Counts per page <select class="custom-table-page-count">' +
                '<option value="10">10</option>' +
                '<option value="25">25</option>' +
                '<option value="50">50</option>' +
                '<option value="100">100</option>' +
                "</select>",
            paginate: {
                first: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84362 0.919211C8.05213 0.708929 8.05213 0.367994 7.84362 0.157712C7.63512 -0.0525706 7.29708 -0.0525706 7.08858 0.157712L3.65638 3.61925C3.63031 3.64553 3.60751 3.67386 3.58796 3.70372C3.45113 3.91272 3.47394 4.19675 3.65638 4.38075L7.08858 7.84229C7.29708 8.05257 7.63512 8.05257 7.84362 7.84229C8.05213 7.63201 8.05213 7.29107 7.84362 7.08079L4.78894 4L7.84362 0.919211Z" fill="#1C1E27"/>
                </svg>
                `,
                last: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M3.65638 0.919211C3.44787 0.708929 3.44787 0.367994 3.65638 0.157712C3.86488 -0.0525706 4.20292 -0.0525706 4.41142 0.157712L7.84362 3.61925C7.86969 3.64553 7.89249 3.67386 7.91204 3.70372C8.04887 3.91272 8.02606 4.19675 7.84362 4.38075L4.41142 7.84229C4.20292 8.05257 3.86488 8.05257 3.65638 7.84229C3.44787 7.63201 3.44787 7.29107 3.65638 7.08079L6.71106 4L3.65638 0.919211Z" fill="#1C1E27"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0.156375 0.919211C-0.0521251 0.708929 -0.0521251 0.367994 0.156375 0.157712C0.364875 -0.0525706 0.702921 -0.0525706 0.911421 0.157712L4.34362 3.61925C4.36969 3.64553 4.39249 3.67386 4.41204 3.70372C4.54887 3.91272 4.52606 4.19675 4.34362 4.38075L0.911421 7.84229C0.702921 8.05257 0.364875 8.05257 0.156375 7.84229C-0.0521251 7.63201 -0.0521251 7.29107 0.156375 7.08079L3.21106 4L0.156375 0.919211Z" fill="#1C1E27"/>
                </svg>
                `,
                next: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0.656375 0.919211C0.447875 0.708929 0.447875 0.367994 0.656375 0.157712C0.864875 -0.0525706 1.20292 -0.0525706 1.41142 0.157712L4.84362 3.61925C4.86969 3.64553 4.89249 3.67386 4.91204 3.70372C5.04887 3.91272 5.02606 4.19675 4.84362 4.38075L1.41142 7.84229C1.20292 8.05257 0.864875 8.05257 0.656375 7.84229C0.447875 7.63201 0.447875 7.29107 0.656375 7.08079L3.71106 4L0.656375 0.919211Z" fill="#1C1E27"/>
                </svg>`,
                previous: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                </svg>`,
            },
            processing: `<span class="overlay-spinner"></span>`,
        },
        columns: [
            { data: 'pk' },
            { data: 'from_email' },
            { data: 'cc_email' },
            { data: 'subject' },
            { data: 'email_body' },
            { data: 'sent_at' }
        ],
        createdRow: function (row, data) {
            // Access the 'isBold' property in the data
            $(row).css('font-size', '14px');
            $(row).css('font-weight', '400');
            $(row).css('border-bottom', '1px solid #F0F3F4');
            $(row).css('padding', '14px 40px');
            $(row).css('height', '40px');
            $(row).css('cursor', 'pointer');
            if (data.isSeen) {
                $(row).css('font-weight', 'bold'); // Apply bold style to the first column 
            }
            $('td', row).eq(-1).css('text-align', 'right');
            {% comment %} $('td', row).eq(0).css('min-width', '50px'); {% endcomment %}
            $('td', row).eq(0).css('max-width', '100px');
        },
        ajax: function (d, callback) {
            console.log("sms table data", d)
            function flattenObject(obj, parentKey = "") {
                    let result = {};
                    {% comment %} console.log("flattenObject", obj) {% endcomment %}
                    for (let key in obj) {
                        if (obj.hasOwnProperty(key)) {
                            let fullKey = parentKey ? `${parentKey}[${key}]` : key;
                            if (typeof obj[key] === "object") {
                                Object.assign(result, flattenObject(obj[key], fullKey));
                            } else {
                                result[fullKey] = obj[key];
                            }
                        }
                    }

                    return result;
                }
                const flattenedObject = flattenObject({...d, search: d.search.value});

                dataTableApiQueries = flattenedObject;

            fetch(`./api/?action=fetch_all_received&${new URLSearchParams(flattenedObject)}`)
                .then(response => response.json())
                .then(data => {
                    $("#unread-received-count").text(data?.response?.length)
                    let newData = {
                            data: data.response.records,
                            recordsFiltered: data?.response?.total_records,
                            recordsTotal: data?.response?.total_records
                        }
                    callback(newData)
                });
        },
        dom: '<"table-top" ><"table-search-box-email-received table-search-box">rt<"table-bottom" <"table-info" i> <"table-pagination-box" l<"table-pagination-box-divider">p> >',
        initComplete: function () { 
            let totalColumns = this.api().columns().count();
            emailReceivedTable.columns.adjust().draw();
            $(".table-search-box-email-received").html(`
                <div class="table-search-input-box com-pkg-search-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <g clip-path="url(#clip0_2358_618)">
                        <path d="M13.9647 13.0221C15.0263 11.7505 15.6646 10.1148 15.6646 8.33314C15.6646 4.28923 12.375 1 8.33388 1C4.28957 1 1 4.28923 1 8.33314C1 12.3762 4.28957 15.6663 8.33388 15.6663C10.1158 15.6663 11.7516 15.0265 13.0233 13.9666L17.8612 18.8039C17.9909 18.9336 18.1612 19 18.333 19C18.5033 19 18.6752 18.9344 18.8049 18.8039C19.065 18.5438 19.065 18.122 18.8049 17.8619L13.9647 13.0221ZM8.33388 14.3321C5.02631 14.3321 2.33431 11.6403 2.33431 8.3331C2.33431 5.02587 5.02631 2.33413 8.33388 2.33413C11.6414 2.33413 14.3335 5.02587 14.3335 8.3331C14.3335 11.6403 11.6414 14.3321 8.33388 14.3321Z" fill="black" stroke="black" stroke-width="0.2"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_2358_618">
                        <rect width="20" height="20" fill="white"/>
                        </clipPath>
                        </defs>
                    </svg>
                    <input id='email_sent_table_search' type="text" placeholder="Search"/>
                </div>
                {% if has_export_perm %}
                    <div class="table-static-action">
                        <button type="button" class="download-button">
                            <span>Download</span>
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18.408 12.9034C18.7349 12.9034 19 13.1658 19 13.4895V15.6002C19 17.4776 17.4623 19 15.566 19H4.43404C2.53774 19 1 17.4776 1 15.6002V13.4895C1 13.1658 1.26509 12.9034 1.59204 12.9034C1.91899 12.9034 2.18408 13.1658 2.18408 13.4895V15.6002C2.18408 16.8302 3.19166 17.8278 4.43408 17.8278H15.566C16.8084 17.8278 17.816 16.8302 17.816 15.6002V13.4895C17.816 13.1658 18.081 12.9034 18.408 12.9034ZM9.99998 2.00008C10.3136 2.00008 10.5709 2.24164 10.5906 2.54723L10.592 2.58621V12.2574L13.1485 9.89548C13.3771 9.68386 13.73 9.68664 13.9557 9.89409L13.9853 9.92402C14.199 10.1503 14.1962 10.4997 13.9867 10.7232L13.9564 10.7524L10.4077 14.0317C10.3965 14.0422 10.3859 14.0512 10.3747 14.061C10.3712 14.0631 10.3684 14.0658 10.3656 14.0679C10.3585 14.0735 10.3508 14.0791 10.3438 14.0839C10.3388 14.0874 10.3339 14.0909 10.3283 14.0944C10.3234 14.0979 10.3184 14.1013 10.3128 14.1041C10.3079 14.1076 10.303 14.1104 10.2973 14.1139C10.2896 14.1181 10.2819 14.1222 10.2734 14.1264L10.2643 14.1313C10.2573 14.1348 10.2495 14.1382 10.2425 14.1417C10.2369 14.1438 10.232 14.1459 10.227 14.148C10.22 14.1508 10.2137 14.1536 10.2073 14.1563L10.1898 14.1619C10.1848 14.164 10.1799 14.1654 10.1743 14.1668C10.1673 14.1689 10.1602 14.171 10.1525 14.173C10.1335 14.1786 10.1131 14.1828 10.0934 14.1856C10.0885 14.1863 10.0829 14.187 10.078 14.1877L10.0386 14.1918L9.99993 14.1925C9.9697 14.1925 9.93946 14.1904 9.90923 14.1863L9.88181 14.1814C9.7004 14.2176 9.50492 14.1696 9.35939 14.0352L5.80655 10.7523C5.56749 10.5316 5.55484 10.1606 5.77772 9.92395C6.00062 9.68727 6.37538 9.67474 6.61443 9.89541L9.40803 12.4765V2.58614C9.40803 2.26244 9.67303 2.00008 9.99998 2.00008Z" fill="black" stroke="black" stroke-width="0.3"/>
                            </svg>
                        </button>
                        <div class="download-confirm-dialog">
                            <div class="download-confirm-dialog-outer">
                                <div class="download-confirm-dialog-messages">
                                    <p>
                                        The report will be available in <strong>My Downloads</strong> in <strong>30 min</strong>.
                                    </p>
                                    <p>
                                        Confirm if you want to proceed with download?
                                    </p>
                                </div> 
                                <button type="button" class="download-confirm-dialog-button">
                                    Download
                                </button>   
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% comment %} <div class="table-action">
                    ${table_metadata?.actions?.table
                    ?.map(({ name, key, icon }) => {
                        return `<button type="button" class="each-table-action-button" data-key="${key}">
                                        ${name
                                ? `<span>${name}</span>`
                                : ""
                            } 
                                        ${icon
                                ? `<img src="${icon}" alt="${name} icon"/>`
                                : ""
                            }
                                    </button>`;
                    })
                    .join("")}
                </div> {% endcomment %}
            `);
            function debounce(func, timeout = 300) {
                    let timer;
                    return (...args) => {
                        clearTimeout(timer);
                        timer = setTimeout(() => { func.apply(this, args); }, timeout);
                    };
                }

            function searchInTable(value) {                        
                emailReceivedTable.search(value).draw()
            }
            const searchFieldChange = debounce((value) => searchInTable(value), 500);

            $(document)
                .find("#email_sent_table_search")
                .on("change keyup paste", function () {
                    let searchValue = $(this).val();
                    console.log('print value search sms', searchValue)
                    searchFieldChange(searchValue);
                });

            new $.fn.dataTable.FixedHeader(emailReceivedTable, {
                headerOffset: $(".table-search-box-email-received").outerHeight(),
                header: true,
                footer: false,
            });

            function resizePaginationInputWidth() {
                let value = $(document).find(".paginate_input").val();
                if (value) {
                    $(document)
                        .find(".paginate_input")
                        .css({ width: `${value.length + 5}ch` });
                }
            }

            resizePaginationInputWidth();

            $(document)
                .find(".paginate_input")
                .on("change keypress", function () {
                    resizePaginationInputWidth();
                });
        }

    })



    let emailSentTable = $('#com-pkg-email-sent-table').DataTable({
        responsive: true,
        ordering: false,
        info: false,
        paging: true,
        pagingType: "input",
        scrollX: true,
        processing: true,
        serverSide: true,
        order: [],
        language: {
            info: "Showing: _START_-_END_/_TOTAL_ entries",
            lengthMenu:
                'Counts per page <select class="custom-table-page-count">' +
                '<option value="10">10</option>' +
                '<option value="25">25</option>' +
                '<option value="50">50</option>' +
                '<option value="100">100</option>' +
                "</select>",
            paginate: {
                first: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84362 0.919211C8.05213 0.708929 8.05213 0.367994 7.84362 0.157712C7.63512 -0.0525706 7.29708 -0.0525706 7.08858 0.157712L3.65638 3.61925C3.63031 3.64553 3.60751 3.67386 3.58796 3.70372C3.45113 3.91272 3.47394 4.19675 3.65638 4.38075L7.08858 7.84229C7.29708 8.05257 7.63512 8.05257 7.84362 7.84229C8.05213 7.63201 8.05213 7.29107 7.84362 7.08079L4.78894 4L7.84362 0.919211Z" fill="#1C1E27"/>
                </svg>
                `,
                last: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M3.65638 0.919211C3.44787 0.708929 3.44787 0.367994 3.65638 0.157712C3.86488 -0.0525706 4.20292 -0.0525706 4.41142 0.157712L7.84362 3.61925C7.86969 3.64553 7.89249 3.67386 7.91204 3.70372C8.04887 3.91272 8.02606 4.19675 7.84362 4.38075L4.41142 7.84229C4.20292 8.05257 3.86488 8.05257 3.65638 7.84229C3.44787 7.63201 3.44787 7.29107 3.65638 7.08079L6.71106 4L3.65638 0.919211Z" fill="#1C1E27"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0.156375 0.919211C-0.0521251 0.708929 -0.0521251 0.367994 0.156375 0.157712C0.364875 -0.0525706 0.702921 -0.0525706 0.911421 0.157712L4.34362 3.61925C4.36969 3.64553 4.39249 3.67386 4.41204 3.70372C4.54887 3.91272 4.52606 4.19675 4.34362 4.38075L0.911421 7.84229C0.702921 8.05257 0.364875 8.05257 0.156375 7.84229C-0.0521251 7.63201 -0.0521251 7.29107 0.156375 7.08079L3.21106 4L0.156375 0.919211Z" fill="#1C1E27"/>
                </svg>
                `,
                next: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M0.656375 0.919211C0.447875 0.708929 0.447875 0.367994 0.656375 0.157712C0.864875 -0.0525706 1.20292 -0.0525706 1.41142 0.157712L4.84362 3.61925C4.86969 3.64553 4.89249 3.67386 4.91204 3.70372C5.04887 3.91272 5.02606 4.19675 4.84362 4.38075L1.41142 7.84229C1.20292 8.05257 0.864875 8.05257 0.656375 7.84229C0.447875 7.63201 0.447875 7.29107 0.656375 7.08079L3.71106 4L0.656375 0.919211Z" fill="#1C1E27"/>
                </svg>`,
                previous: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                </svg>`,
            },
            processing: `<span class="overlay-spinner"></span>`,
        },
        columns: [
            { data: 'to_email', width: "200" },
            { data: 'subject' },
            { data: 'email_body' },
            { data: 'message_id' },
        ],
        columnDefs: [
                {
                    targets: 2, // Index of the column to format (0-based index)
                    render: function (data, type, row) {
                        const decodedContent = new DOMParser().parseFromString(data, 'text/html').body.textContent;

                        // Example: Format age by appending " years" to the value
                        return decodedContent;
                    }
                }
                // Add more columnDefs as needed
        ],
        createdRow: function (row, data) {
            // Access the 'isBold' property in the data
            $(row).css('font-size', '14px');
            $(row).css('font-weight', '400');
            $(row).css('border-bottom', '1px solid #F0F3F4');
            $(row).css('padding', '14px 40px');
            $(row).css('height', '40px');
            $(row).css('cursor', 'pointer');
            $('td', row).eq(-1).css('text-align', 'right');
            $('td', row).eq(0).css('max-width', '100px');
        },

        ajax: function (d, callback) {
            console.log("sms table data", d)
            function flattenObject(obj, parentKey = "") {
                    let result = {};
                    {% comment %} console.log("flattenObject", obj) {% endcomment %}
                    for (let key in obj) {
                        if (obj.hasOwnProperty(key)) {
                            let fullKey = parentKey ? `${parentKey}[${key}]` : key;
                            if (typeof obj[key] === "object") {
                                Object.assign(result, flattenObject(obj[key], fullKey));
                            } else {
                                result[fullKey] = obj[key];
                            }
                        }
                    }

                    return result;
                }
                const flattenedObject = flattenObject({...d, search: d.search.value});

                dataTableApiQueries = flattenedObject;

            fetch(`./api/?action=fetch_all_sent&${new URLSearchParams(flattenedObject)}`)
                .then(response => response.json())
                .then(data => {
                    console.log("print sent table response data", data)
                    $("#unread-received-count").text(data?.response?.length)
                    let newData = {
                            data: data.response.records,
                            recordsFiltered: data?.response?.total_records,
                            recordsTotal: data?.response?.total_records
                        }
                    callback(newData)
                });
        },

        dom: '<"table-top" ><"table-search-box-email-sent table-search-box">rt<"table-bottom" <"table-info" i> <"table-pagination-box" l<"table-pagination-box-divider">p> >',
        initComplete: function () { 
            let totalColumns = this.api().columns().count();
            emailSentTable.columns.adjust().draw();
            $(".table-search-box-email-sent").html(`
                <div class="table-search-input-box com-pkg-search-box">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <g clip-path="url(#clip0_2358_618)">
                        <path d="M13.9647 13.0221C15.0263 11.7505 15.6646 10.1148 15.6646 8.33314C15.6646 4.28923 12.375 1 8.33388 1C4.28957 1 1 4.28923 1 8.33314C1 12.3762 4.28957 15.6663 8.33388 15.6663C10.1158 15.6663 11.7516 15.0265 13.0233 13.9666L17.8612 18.8039C17.9909 18.9336 18.1612 19 18.333 19C18.5033 19 18.6752 18.9344 18.8049 18.8039C19.065 18.5438 19.065 18.122 18.8049 17.8619L13.9647 13.0221ZM8.33388 14.3321C5.02631 14.3321 2.33431 11.6403 2.33431 8.3331C2.33431 5.02587 5.02631 2.33413 8.33388 2.33413C11.6414 2.33413 14.3335 5.02587 14.3335 8.3331C14.3335 11.6403 11.6414 14.3321 8.33388 14.3321Z" fill="black" stroke="black" stroke-width="0.2"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_2358_618">
                        <rect width="20" height="20" fill="white"/>
                        </clipPath>
                        </defs>
                    </svg>
                    <input id='email_sent_table_search' type="text" placeholder="Search"/>
                </div>
                {% if has_export_perm %}
                    <div class="table-static-action">
                        <button type="button" class="download-button">
                            <span>Download</span>
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18.408 12.9034C18.7349 12.9034 19 13.1658 19 13.4895V15.6002C19 17.4776 17.4623 19 15.566 19H4.43404C2.53774 19 1 17.4776 1 15.6002V13.4895C1 13.1658 1.26509 12.9034 1.59204 12.9034C1.91899 12.9034 2.18408 13.1658 2.18408 13.4895V15.6002C2.18408 16.8302 3.19166 17.8278 4.43408 17.8278H15.566C16.8084 17.8278 17.816 16.8302 17.816 15.6002V13.4895C17.816 13.1658 18.081 12.9034 18.408 12.9034ZM9.99998 2.00008C10.3136 2.00008 10.5709 2.24164 10.5906 2.54723L10.592 2.58621V12.2574L13.1485 9.89548C13.3771 9.68386 13.73 9.68664 13.9557 9.89409L13.9853 9.92402C14.199 10.1503 14.1962 10.4997 13.9867 10.7232L13.9564 10.7524L10.4077 14.0317C10.3965 14.0422 10.3859 14.0512 10.3747 14.061C10.3712 14.0631 10.3684 14.0658 10.3656 14.0679C10.3585 14.0735 10.3508 14.0791 10.3438 14.0839C10.3388 14.0874 10.3339 14.0909 10.3283 14.0944C10.3234 14.0979 10.3184 14.1013 10.3128 14.1041C10.3079 14.1076 10.303 14.1104 10.2973 14.1139C10.2896 14.1181 10.2819 14.1222 10.2734 14.1264L10.2643 14.1313C10.2573 14.1348 10.2495 14.1382 10.2425 14.1417C10.2369 14.1438 10.232 14.1459 10.227 14.148C10.22 14.1508 10.2137 14.1536 10.2073 14.1563L10.1898 14.1619C10.1848 14.164 10.1799 14.1654 10.1743 14.1668C10.1673 14.1689 10.1602 14.171 10.1525 14.173C10.1335 14.1786 10.1131 14.1828 10.0934 14.1856C10.0885 14.1863 10.0829 14.187 10.078 14.1877L10.0386 14.1918L9.99993 14.1925C9.9697 14.1925 9.93946 14.1904 9.90923 14.1863L9.88181 14.1814C9.7004 14.2176 9.50492 14.1696 9.35939 14.0352L5.80655 10.7523C5.56749 10.5316 5.55484 10.1606 5.77772 9.92395C6.00062 9.68727 6.37538 9.67474 6.61443 9.89541L9.40803 12.4765V2.58614C9.40803 2.26244 9.67303 2.00008 9.99998 2.00008Z" fill="black" stroke="black" stroke-width="0.3"/>
                            </svg>
                        </button>
                        <div class="download-confirm-dialog">
                            <div class="download-confirm-dialog-outer">
                                <div class="download-confirm-dialog-messages">
                                    <p>
                                        The report will be available in <strong>My Downloads</strong> in <strong>30 min</strong>.
                                    </p>
                                    <p>
                                        Confirm if you want to proceed with download?
                                    </p>
                                </div> 
                                <button type="button" class="download-confirm-dialog-button">
                                    Download
                                </button>   
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% comment %} <div class="table-action">
                    ${table_metadata?.actions?.table
                    ?.map(({ name, key, icon }) => {
                        return `<button type="button" class="each-table-action-button" data-key="${key}">
                                        ${name
                                ? `<span>${name}</span>`
                                : ""
                            } 
                                        ${icon
                                ? `<img src="${icon}" alt="${name} icon"/>`
                                : ""
                            }
                                    </button>`;
                    })
                    .join("")}
                </div> {% endcomment %}
            `);
            function debounce(func, timeout = 300) {
                    let timer;
                    return (...args) => {
                        clearTimeout(timer);
                        timer = setTimeout(() => { func.apply(this, args); }, timeout);
                    };
                }

            function searchInTable(value) {                        
                emailSentTable.search(value).draw()
            }
            const searchFieldChange = debounce((value) => searchInTable(value), 500);

            $(document)
                .find("#email_sent_table_search")
                .on("change keyup paste", function () {
                    let searchValue = $(this).val();
                    console.log('print value search sms', searchValue)
                    searchFieldChange(searchValue);
                });

            new $.fn.dataTable.FixedHeader(emailSentTable, {
                headerOffset: $(".table-search-box-email-sent").outerHeight(),
                header: true,
                footer: false,
            });

            function resizePaginationInputWidth() {
                let value = $(document).find(".paginate_input").val();
                if (value) {
                    $(document)
                        .find(".paginate_input")
                        .css({ width: `${value.length + 5}ch` });
                }
            }

            resizePaginationInputWidth();

            $(document)
                .find(".paginate_input")
                .on("change keypress", function () {
                    resizePaginationInputWidth();
                });
        }
                
    })


    let emailDraftTable = $('#com-pkg-email-draft-table').DataTable({
            responsive: true,
            ordering: false,
            info: false,
            paging: true,
            pagingType: "input",
            scrollX: true,
            processing: true,
            serverSide: true,
            order: [],
            language: {
                info: "Showing: _START_-_END_/_TOTAL_ entries",
                lengthMenu:
                    'Counts per page <select class="custom-table-page-count">' +
                    '<option value="10">10</option>' +
                    '<option value="25">25</option>' +
                    '<option value="50">50</option>' +
                    '<option value="100">100</option>' +
                    "</select>",
                paginate: {
                    first: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84362 0.919211C8.05213 0.708929 8.05213 0.367994 7.84362 0.157712C7.63512 -0.0525706 7.29708 -0.0525706 7.08858 0.157712L3.65638 3.61925C3.63031 3.64553 3.60751 3.67386 3.58796 3.70372C3.45113 3.91272 3.47394 4.19675 3.65638 4.38075L7.08858 7.84229C7.29708 8.05257 7.63512 8.05257 7.84362 7.84229C8.05213 7.63201 8.05213 7.29107 7.84362 7.08079L4.78894 4L7.84362 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    last: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.65638 0.919211C3.44787 0.708929 3.44787 0.367994 3.65638 0.157712C3.86488 -0.0525706 4.20292 -0.0525706 4.41142 0.157712L7.84362 3.61925C7.86969 3.64553 7.89249 3.67386 7.91204 3.70372C8.04887 3.91272 8.02606 4.19675 7.84362 4.38075L4.41142 7.84229C4.20292 8.05257 3.86488 8.05257 3.65638 7.84229C3.44787 7.63201 3.44787 7.29107 3.65638 7.08079L6.71106 4L3.65638 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.156375 0.919211C-0.0521251 0.708929 -0.0521251 0.367994 0.156375 0.157712C0.364875 -0.0525706 0.702921 -0.0525706 0.911421 0.157712L4.34362 3.61925C4.36969 3.64553 4.39249 3.67386 4.41204 3.70372C4.54887 3.91272 4.52606 4.19675 4.34362 4.38075L0.911421 7.84229C0.702921 8.05257 0.364875 8.05257 0.156375 7.84229C-0.0521251 7.63201 -0.0521251 7.29107 0.156375 7.08079L3.21106 4L0.156375 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    next: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.656375 0.919211C0.447875 0.708929 0.447875 0.367994 0.656375 0.157712C0.864875 -0.0525706 1.20292 -0.0525706 1.41142 0.157712L4.84362 3.61925C4.86969 3.64553 4.89249 3.67386 4.91204 3.70372C5.04887 3.91272 5.02606 4.19675 4.84362 4.38075L1.41142 7.84229C1.20292 8.05257 0.864875 8.05257 0.656375 7.84229C0.447875 7.63201 0.447875 7.29107 0.656375 7.08079L3.71106 4L0.656375 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                    previous: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                },
                processing: `<span class="overlay-spinner"></span>`,
            },
            columns: [
                { data: 'to_email', width: "200" },
                { data: 'subject' },
                { data: 'email_body' },
                { data: 'message_id' },
                { data: 'read', visible: false }
            ],
            columnDefs: [
                {
                    targets: 2, // Index of the column to format (0-based index)
                    render: function (data, type, row) {
                        const decodedContent = new DOMParser().parseFromString(data, 'text/html').body.textContent;

                        // Example: Format age by appending " years" to the value
                        return decodedContent;
                    }
                }
                // Add more columnDefs as needed
            ],
            createdRow: function (row, data) {
                // Access the 'isBold' property in the data
                $(row).css('font-size', '14px');
                $(row).css('font-weight', '400');
                $(row).css('border-bottom', '1px solid #F0F3F4');
                $(row).css('padding', '14px 40px');
                $(row).css('height', '40px');
                $(row).css('cursor', 'pointer');
                $('td', row).eq(-1).css('text-align', 'right');
                $('td', row).eq(0).css('max-width', '100px');

            },
            ajax: function (d, callback) {

                console.log("draft mail data", d)

                function flattenObject(obj, parentKey = "") {
                        let result = {};
                        for (let key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                let fullKey = parentKey ? `${parentKey}[${key}]` : key;
                                if (typeof obj[key] === "object") {
                                    Object.assign(result, flattenObject(obj[key], fullKey));
                                } else {
                                    result[fullKey] = obj[key];
                                }
                            }
                        }

                        return result;
                    }
                const flattenedObject = flattenObject({...d, search: d.search.value});

                dataTableApiQueries = flattenedObject;


                fetch(`./api/?action=fetch_all_drafts&${new URLSearchParams(flattenedObject)}`)
                    .then(response => response.json())
                    .then(data => {
                        $("#draft-count").text(data.response.total_records)
                        let newData = {
                            data: data.response.records,
                            recordsFiltered: data?.response?.total_records,
                            recordsTotal: data?.response?.total_records
                        }
                        callback(newData)
                    });
            },
            dom: '<"table-top" ><"table-search-box-email-draft table-search-box">rt<"table-bottom" <"table-info" i> <"table-pagination-box" l<"table-pagination-box-divider">p> >',
            initComplete: function () { 
                let totalColumns = this.api().columns().count();
                emailDraftTable.columns.adjust().draw();
                $(".table-search-box-email-draft").html(`
                    <div class="table-search-input-box com-pkg-search-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <g clip-path="url(#clip0_2358_618)">
                            <path d="M13.9647 13.0221C15.0263 11.7505 15.6646 10.1148 15.6646 8.33314C15.6646 4.28923 12.375 1 8.33388 1C4.28957 1 1 4.28923 1 8.33314C1 12.3762 4.28957 15.6663 8.33388 15.6663C10.1158 15.6663 11.7516 15.0265 13.0233 13.9666L17.8612 18.8039C17.9909 18.9336 18.1612 19 18.333 19C18.5033 19 18.6752 18.9344 18.8049 18.8039C19.065 18.5438 19.065 18.122 18.8049 17.8619L13.9647 13.0221ZM8.33388 14.3321C5.02631 14.3321 2.33431 11.6403 2.33431 8.3331C2.33431 5.02587 5.02631 2.33413 8.33388 2.33413C11.6414 2.33413 14.3335 5.02587 14.3335 8.3331C14.3335 11.6403 11.6414 14.3321 8.33388 14.3321Z" fill="black" stroke="black" stroke-width="0.2"/>
                            </g>
                            <defs>
                            <clipPath id="clip0_2358_618">
                            <rect width="20" height="20" fill="white"/>
                            </clipPath>
                            </defs>
                        </svg>
                        <input id='email_draft_table_search' type="text" placeholder="Search"/>
                    </div>
                    {% if has_export_perm %}
                        <div class="table-static-action">
                            <button type="button" class="download-button">
                                <span>Download</span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18.408 12.9034C18.7349 12.9034 19 13.1658 19 13.4895V15.6002C19 17.4776 17.4623 19 15.566 19H4.43404C2.53774 19 1 17.4776 1 15.6002V13.4895C1 13.1658 1.26509 12.9034 1.59204 12.9034C1.91899 12.9034 2.18408 13.1658 2.18408 13.4895V15.6002C2.18408 16.8302 3.19166 17.8278 4.43408 17.8278H15.566C16.8084 17.8278 17.816 16.8302 17.816 15.6002V13.4895C17.816 13.1658 18.081 12.9034 18.408 12.9034ZM9.99998 2.00008C10.3136 2.00008 10.5709 2.24164 10.5906 2.54723L10.592 2.58621V12.2574L13.1485 9.89548C13.3771 9.68386 13.73 9.68664 13.9557 9.89409L13.9853 9.92402C14.199 10.1503 14.1962 10.4997 13.9867 10.7232L13.9564 10.7524L10.4077 14.0317C10.3965 14.0422 10.3859 14.0512 10.3747 14.061C10.3712 14.0631 10.3684 14.0658 10.3656 14.0679C10.3585 14.0735 10.3508 14.0791 10.3438 14.0839C10.3388 14.0874 10.3339 14.0909 10.3283 14.0944C10.3234 14.0979 10.3184 14.1013 10.3128 14.1041C10.3079 14.1076 10.303 14.1104 10.2973 14.1139C10.2896 14.1181 10.2819 14.1222 10.2734 14.1264L10.2643 14.1313C10.2573 14.1348 10.2495 14.1382 10.2425 14.1417C10.2369 14.1438 10.232 14.1459 10.227 14.148C10.22 14.1508 10.2137 14.1536 10.2073 14.1563L10.1898 14.1619C10.1848 14.164 10.1799 14.1654 10.1743 14.1668C10.1673 14.1689 10.1602 14.171 10.1525 14.173C10.1335 14.1786 10.1131 14.1828 10.0934 14.1856C10.0885 14.1863 10.0829 14.187 10.078 14.1877L10.0386 14.1918L9.99993 14.1925C9.9697 14.1925 9.93946 14.1904 9.90923 14.1863L9.88181 14.1814C9.7004 14.2176 9.50492 14.1696 9.35939 14.0352L5.80655 10.7523C5.56749 10.5316 5.55484 10.1606 5.77772 9.92395C6.00062 9.68727 6.37538 9.67474 6.61443 9.89541L9.40803 12.4765V2.58614C9.40803 2.26244 9.67303 2.00008 9.99998 2.00008Z" fill="black" stroke="black" stroke-width="0.3"/>
                                </svg>
                            </button>
                            <div class="download-confirm-dialog">
                                <div class="download-confirm-dialog-outer">
                                    <div class="download-confirm-dialog-messages">
                                        <p>
                                            The report will be available in <strong>My Downloads</strong> in <strong>30 min</strong>.
                                        </p>
                                        <p>
                                            Confirm if you want to proceed with download?
                                        </p>
                                    </div> 
                                    <button type="button" class="download-confirm-dialog-button">
                                        Download
                                    </button>   
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% comment %} <div class="table-action">
                        ${table_metadata?.actions?.table
                        ?.map(({ name, key, icon }) => {
                            return `<button type="button" class="each-table-action-button" data-key="${key}">
                                            ${name
                                    ? `<span>${name}</span>`
                                    : ""
                                } 
                                            ${icon
                                    ? `<img src="${icon}" alt="${name} icon"/>`
                                    : ""
                                }
                                        </button>`;
                        })
                        .join("")}
                    </div> {% endcomment %}
                `);
                function debounce(func, timeout = 300) {
                        let timer;
                        return (...args) => {
                            clearTimeout(timer);
                            timer = setTimeout(() => { func.apply(this, args); }, timeout);
                        };
                    }

                function searchInTable(value) {                        
                    emailDraftTable.search(value).draw()
                }
                const searchFieldChange = debounce((value) => searchInTable(value), 500);

                $(document)
                    .find("#email_draft_table_search")
                    .on("change keyup paste", function () {
                        let searchValue = $(this).val();
                        console.log('print value search sms', searchValue)
                        searchFieldChange(searchValue);
                    });

                new $.fn.dataTable.FixedHeader(emailDraftTable, {
                    headerOffset: $(".table-search-box-email-draft").outerHeight(),
                    header: true,
                    footer: false,
                });

                function resizePaginationInputWidth() {
                    let value = $(document).find(".paginate_input").val();
                    if (value) {
                        $(document)
                            .find(".paginate_input")
                            .css({ width: `${value.length + 5}ch` });
                    }
                }

                resizePaginationInputWidth();

                $(document)
                    .find(".paginate_input")
                    .on("change keypress", function () {
                        resizePaginationInputWidth();
                    });
            }
    })

    let smsSentTable = $('#com-pkg-sms-sent-table').DataTable({
            responsive: true,
            ordering: false,
            info: false,
            paging: true,
            pagingType: "input",
            scrollX: true,
            processing: true,
            serverSide: true,
            order: [],
            language: {
                info: "Showing: _START_-_END_/_TOTAL_ entries",
                lengthMenu:
                    'Counts per page <select class="custom-table-page-count">' +
                    '<option value="10">10</option>' +
                    '<option value="25">25</option>' +
                    '<option value="50">50</option>' +
                    '<option value="100">100</option>' +
                    "</select>",
                paginate: {
                    first: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84362 0.919211C8.05213 0.708929 8.05213 0.367994 7.84362 0.157712C7.63512 -0.0525706 7.29708 -0.0525706 7.08858 0.157712L3.65638 3.61925C3.63031 3.64553 3.60751 3.67386 3.58796 3.70372C3.45113 3.91272 3.47394 4.19675 3.65638 4.38075L7.08858 7.84229C7.29708 8.05257 7.63512 8.05257 7.84362 7.84229C8.05213 7.63201 8.05213 7.29107 7.84362 7.08079L4.78894 4L7.84362 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    last: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.65638 0.919211C3.44787 0.708929 3.44787 0.367994 3.65638 0.157712C3.86488 -0.0525706 4.20292 -0.0525706 4.41142 0.157712L7.84362 3.61925C7.86969 3.64553 7.89249 3.67386 7.91204 3.70372C8.04887 3.91272 8.02606 4.19675 7.84362 4.38075L4.41142 7.84229C4.20292 8.05257 3.86488 8.05257 3.65638 7.84229C3.44787 7.63201 3.44787 7.29107 3.65638 7.08079L6.71106 4L3.65638 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.156375 0.919211C-0.0521251 0.708929 -0.0521251 0.367994 0.156375 0.157712C0.364875 -0.0525706 0.702921 -0.0525706 0.911421 0.157712L4.34362 3.61925C4.36969 3.64553 4.39249 3.67386 4.41204 3.70372C4.54887 3.91272 4.52606 4.19675 4.34362 4.38075L0.911421 7.84229C0.702921 8.05257 0.364875 8.05257 0.156375 7.84229C-0.0521251 7.63201 -0.0521251 7.29107 0.156375 7.08079L3.21106 4L0.156375 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    next: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.656375 0.919211C0.447875 0.708929 0.447875 0.367994 0.656375 0.157712C0.864875 -0.0525706 1.20292 -0.0525706 1.41142 0.157712L4.84362 3.61925C4.86969 3.64553 4.89249 3.67386 4.91204 3.70372C5.04887 3.91272 5.02606 4.19675 4.84362 4.38075L1.41142 7.84229C1.20292 8.05257 0.864875 8.05257 0.656375 7.84229C0.447875 7.63201 0.447875 7.29107 0.656375 7.08079L3.71106 4L0.656375 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                    previous: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                },
                processing: `<span class="overlay-spinner"></span>`,
            },
            columns: [
                { data: 'pk' },
                { data: 'to_number' },
                { data: 'message' },
                { data: 'status' },
                { data: 'date_sent' },
            ],
            createdRow: function (row, data) {
                // Access the 'isBold' property in the data
                $(row).css('font-size', '14px');
                $(row).css('font-weight', '400');
                $(row).css('border-bottom', '1px solid #F0F3F4');
                $(row).css('padding', '14px 40px');
                $(row).css('height', '40px');
                $(row).css('cursor', 'pointer');
                $('td', row).eq(-1).css('text-align', 'right');
                $('td', row).eq(0).css('max-width', '100px');
            },
            ajax: function (d, callback) {
                console.log("sms table data", d)
                function flattenObject(obj, parentKey = "") {
                        let result = {};
                        for (let key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                let fullKey = parentKey ? `${parentKey}[${key}]` : key;
                                if (typeof obj[key] === "object") {
                                    Object.assign(result, flattenObject(obj[key], fullKey));
                                } else {
                                    result[fullKey] = obj[key];
                                }
                            }
                        }

                        return result;
                }
                const flattenedObject = flattenObject({...d, search: d.search.value});

                dataTableApiQueries = flattenedObject;

                fetch(`./api/?action=fetch_sms_records&${new URLSearchParams(flattenedObject)}`, {
                        method: "GET",
                        headers: {
                            'X-CSRFToken': "{{csrf_token|safe}}"
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        let newData = {
                                data: data.response.records,
                                recordsFiltered: data?.response?.total_records,
                                recordsTotal: data?.response?.total_records
                            }
                        callback(newData)
                    });
            },
            dom: '<"table-top" ><"table-search-box-sms-sent table-search-box">rt<"table-bottom" <"table-info" i> <"table-pagination-box" l<"table-pagination-box-divider">p> >',
            initComplete: function () { 
                let totalColumns = this.api().columns().count();
                smsSentTable.columns.adjust().draw();
                $(".table-search-box-sms-sent").html(`
                    <div class="table-search-input-box com-pkg-search-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <g clip-path="url(#clip0_2358_618)">
                            <path d="M13.9647 13.0221C15.0263 11.7505 15.6646 10.1148 15.6646 8.33314C15.6646 4.28923 12.375 1 8.33388 1C4.28957 1 1 4.28923 1 8.33314C1 12.3762 4.28957 15.6663 8.33388 15.6663C10.1158 15.6663 11.7516 15.0265 13.0233 13.9666L17.8612 18.8039C17.9909 18.9336 18.1612 19 18.333 19C18.5033 19 18.6752 18.9344 18.8049 18.8039C19.065 18.5438 19.065 18.122 18.8049 17.8619L13.9647 13.0221ZM8.33388 14.3321C5.02631 14.3321 2.33431 11.6403 2.33431 8.3331C2.33431 5.02587 5.02631 2.33413 8.33388 2.33413C11.6414 2.33413 14.3335 5.02587 14.3335 8.3331C14.3335 11.6403 11.6414 14.3321 8.33388 14.3321Z" fill="black" stroke="black" stroke-width="0.2"/>
                            </g>
                            <defs>
                            <clipPath id="clip0_2358_618">
                            <rect width="20" height="20" fill="white"/>
                            </clipPath>
                            </defs>
                        </svg>
                        <input id='table_search' type="text" placeholder="Search"/>
                    </div>
                    {% if has_export_perm %}
                        <div class="table-static-action">
                            <button type="button" class="download-button">
                                <span>Download</span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18.408 12.9034C18.7349 12.9034 19 13.1658 19 13.4895V15.6002C19 17.4776 17.4623 19 15.566 19H4.43404C2.53774 19 1 17.4776 1 15.6002V13.4895C1 13.1658 1.26509 12.9034 1.59204 12.9034C1.91899 12.9034 2.18408 13.1658 2.18408 13.4895V15.6002C2.18408 16.8302 3.19166 17.8278 4.43408 17.8278H15.566C16.8084 17.8278 17.816 16.8302 17.816 15.6002V13.4895C17.816 13.1658 18.081 12.9034 18.408 12.9034ZM9.99998 2.00008C10.3136 2.00008 10.5709 2.24164 10.5906 2.54723L10.592 2.58621V12.2574L13.1485 9.89548C13.3771 9.68386 13.73 9.68664 13.9557 9.89409L13.9853 9.92402C14.199 10.1503 14.1962 10.4997 13.9867 10.7232L13.9564 10.7524L10.4077 14.0317C10.3965 14.0422 10.3859 14.0512 10.3747 14.061C10.3712 14.0631 10.3684 14.0658 10.3656 14.0679C10.3585 14.0735 10.3508 14.0791 10.3438 14.0839C10.3388 14.0874 10.3339 14.0909 10.3283 14.0944C10.3234 14.0979 10.3184 14.1013 10.3128 14.1041C10.3079 14.1076 10.303 14.1104 10.2973 14.1139C10.2896 14.1181 10.2819 14.1222 10.2734 14.1264L10.2643 14.1313C10.2573 14.1348 10.2495 14.1382 10.2425 14.1417C10.2369 14.1438 10.232 14.1459 10.227 14.148C10.22 14.1508 10.2137 14.1536 10.2073 14.1563L10.1898 14.1619C10.1848 14.164 10.1799 14.1654 10.1743 14.1668C10.1673 14.1689 10.1602 14.171 10.1525 14.173C10.1335 14.1786 10.1131 14.1828 10.0934 14.1856C10.0885 14.1863 10.0829 14.187 10.078 14.1877L10.0386 14.1918L9.99993 14.1925C9.9697 14.1925 9.93946 14.1904 9.90923 14.1863L9.88181 14.1814C9.7004 14.2176 9.50492 14.1696 9.35939 14.0352L5.80655 10.7523C5.56749 10.5316 5.55484 10.1606 5.77772 9.92395C6.00062 9.68727 6.37538 9.67474 6.61443 9.89541L9.40803 12.4765V2.58614C9.40803 2.26244 9.67303 2.00008 9.99998 2.00008Z" fill="black" stroke="black" stroke-width="0.3"/>
                                </svg>
                            </button>
                            <div class="download-confirm-dialog">
                                <div class="download-confirm-dialog-outer">
                                    <div class="download-confirm-dialog-messages">
                                        <p>
                                            The report will be available in <strong>My Downloads</strong> in <strong>30 min</strong>.
                                        </p>
                                        <p>
                                            Confirm if you want to proceed with download?
                                        </p>
                                    </div> 
                                    <button type="button" class="download-confirm-dialog-button">
                                        Download
                                    </button>   
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% comment %} <div class="table-action">
                        ${table_metadata?.actions?.table
                        ?.map(({ name, key, icon }) => {
                            return `<button type="button" class="each-table-action-button" data-key="${key}">
                                            ${name
                                    ? `<span>${name}</span>`
                                    : ""
                                } 
                                            ${icon
                                    ? `<img src="${icon}" alt="${name} icon"/>`
                                    : ""
                                }
                                        </button>`;
                        })
                        .join("")}
                    </div> {% endcomment %}
                `);
                function debounce(func, timeout = 300) {
                        let timer;
                        return (...args) => {
                            clearTimeout(timer);
                            timer = setTimeout(() => { func.apply(this, args); }, timeout);
                        };
                    }

                function searchInTable(value) {                        
                    smsSentTable.search(value).draw()
                }
                const searchFieldChange = debounce((value) => searchInTable(value), 500);

                $(document)
                    .find("#table_search")
                    .on("change keyup paste", function () {
                        let searchValue = $(this).val();
                        console.log('print value search sms', searchValue)
                        searchFieldChange(searchValue);
                    });

                new $.fn.dataTable.FixedHeader(smsSentTable, {
                    headerOffset: $(".table-search-box-sms-sent").outerHeight(),
                    header: true,
                    footer: false,
                });

                function resizePaginationInputWidth() {
                    let value = $(document).find(".paginate_input").val();
                    if (value) {
                        $(document)
                            .find(".paginate_input")
                            .css({ width: `${value.length + 5}ch` });
                    }
                }

                resizePaginationInputWidth();

                $(document)
                    .find(".paginate_input")
                    .on("change keypress", function () {
                        resizePaginationInputWidth();
                    });
            }
    })


    let telephonyOutgoingTable = $('#com-pkg-telephony-outgoing-table').DataTable({
            responsive: true,
            ordering: false,
            info: false,
            paging: true,
            pagingType: "input",
            scrollX: true,
            processing: true,
            serverSide: true,
            order: [],
            language: {
                info: "Showing: _START_-_END_/_TOTAL_ entries",
                lengthMenu:
                    'Counts per page <select class="custom-table-page-count">' +
                    '<option value="10">10</option>' +
                    '<option value="25">25</option>' +
                    '<option value="50">50</option>' +
                    '<option value="100">100</option>' +
                    "</select>",
                paginate: {
                    first: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84362 0.919211C8.05213 0.708929 8.05213 0.367994 7.84362 0.157712C7.63512 -0.0525706 7.29708 -0.0525706 7.08858 0.157712L3.65638 3.61925C3.63031 3.64553 3.60751 3.67386 3.58796 3.70372C3.45113 3.91272 3.47394 4.19675 3.65638 4.38075L7.08858 7.84229C7.29708 8.05257 7.63512 8.05257 7.84362 7.84229C8.05213 7.63201 8.05213 7.29107 7.84362 7.08079L4.78894 4L7.84362 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    last: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.65638 0.919211C3.44787 0.708929 3.44787 0.367994 3.65638 0.157712C3.86488 -0.0525706 4.20292 -0.0525706 4.41142 0.157712L7.84362 3.61925C7.86969 3.64553 7.89249 3.67386 7.91204 3.70372C8.04887 3.91272 8.02606 4.19675 7.84362 4.38075L4.41142 7.84229C4.20292 8.05257 3.86488 8.05257 3.65638 7.84229C3.44787 7.63201 3.44787 7.29107 3.65638 7.08079L6.71106 4L3.65638 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.156375 0.919211C-0.0521251 0.708929 -0.0521251 0.367994 0.156375 0.157712C0.364875 -0.0525706 0.702921 -0.0525706 0.911421 0.157712L4.34362 3.61925C4.36969 3.64553 4.39249 3.67386 4.41204 3.70372C4.54887 3.91272 4.52606 4.19675 4.34362 4.38075L0.911421 7.84229C0.702921 8.05257 0.364875 8.05257 0.156375 7.84229C-0.0521251 7.63201 -0.0521251 7.29107 0.156375 7.08079L3.21106 4L0.156375 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    next: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.656375 0.919211C0.447875 0.708929 0.447875 0.367994 0.656375 0.157712C0.864875 -0.0525706 1.20292 -0.0525706 1.41142 0.157712L4.84362 3.61925C4.86969 3.64553 4.89249 3.67386 4.91204 3.70372C5.04887 3.91272 5.02606 4.19675 4.84362 4.38075L1.41142 7.84229C1.20292 8.05257 0.864875 8.05257 0.656375 7.84229C0.447875 7.63201 0.447875 7.29107 0.656375 7.08079L3.71106 4L0.656375 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                    previous: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                },
                processing: `<span class="overlay-spinner"></span>`,
            },
            columns: [
                { data: 'pk' },
                { data: 'destination_number' },
                { data: 'call_record_url' },
                { data: 'call_type' },
                { data: 'agentId' },
                { data: 'start_time' },
                { data: 'call_duration' },
            ],
            createdRow: function (row, data) {
                // Access the 'isBold' property in the data
                $(row).css('font-size', '14px');
                $(row).css('font-weight', '400');
                $(row).css('border-bottom', '1px solid #F0F3F4');
                $(row).css('padding', '14px 40px');
                $(row).css('height', '40px');
                $(row).css('cursor', 'pointer');
                $('td', row).eq(-1).css('text-align', 'right');
                $('td', row).eq(0).css('max-width', '100px');
            },
            ajax: function (d, callback) {
                console.log("sms table data", d)
                function flattenObject(obj, parentKey = "") {
                        let result = {};
                        for (let key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                let fullKey = parentKey ? `${parentKey}[${key}]` : key;
                                if (typeof obj[key] === "object") {
                                    Object.assign(result, flattenObject(obj[key], fullKey));
                                } else {
                                    result[fullKey] = obj[key];
                                }
                            }
                        }

                        return result;
                }
                const flattenedObject = flattenObject({...d, search: d.search.value});

                dataTableApiQueries = flattenedObject;

                fetch(`./api/?action=fetch_call_records&${new URLSearchParams(flattenedObject)}`, {
                        method: "GET",
                        headers: {
                            'X-CSRFToken': "{{csrf_token|safe}}"
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        let newData = {
                                data: data.response.records,
                                recordsFiltered: data?.response?.total_records,
                                recordsTotal: data?.response?.total_records
                            }
                        callback(newData)
                    });
            },
            dom: '<"table-top" ><"table-search-box-telephony-outgoing table-search-box">rt<"table-bottom" <"table-info" i> <"table-pagination-box" l<"table-pagination-box-divider">p> >',
            initComplete: function () { 
                let totalColumns = this.api().columns().count();
                telephonyOutgoingTable.columns.adjust().draw();
                $(".table-search-box-telephony-outgoing").html(`
                    <div class="table-search-input-box com-pkg-search-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <g clip-path="url(#clip0_2358_618)">
                            <path d="M13.9647 13.0221C15.0263 11.7505 15.6646 10.1148 15.6646 8.33314C15.6646 4.28923 12.375 1 8.33388 1C4.28957 1 1 4.28923 1 8.33314C1 12.3762 4.28957 15.6663 8.33388 15.6663C10.1158 15.6663 11.7516 15.0265 13.0233 13.9666L17.8612 18.8039C17.9909 18.9336 18.1612 19 18.333 19C18.5033 19 18.6752 18.9344 18.8049 18.8039C19.065 18.5438 19.065 18.122 18.8049 17.8619L13.9647 13.0221ZM8.33388 14.3321C5.02631 14.3321 2.33431 11.6403 2.33431 8.3331C2.33431 5.02587 5.02631 2.33413 8.33388 2.33413C11.6414 2.33413 14.3335 5.02587 14.3335 8.3331C14.3335 11.6403 11.6414 14.3321 8.33388 14.3321Z" fill="black" stroke="black" stroke-width="0.2"/>
                            </g>
                            <defs>
                            <clipPath id="clip0_2358_618">
                            <rect width="20" height="20" fill="white"/>
                            </clipPath>
                            </defs>
                        </svg>
                        <input id='table_search' type="text" placeholder="Search"/>
                    </div>
                    {% if has_export_perm %}
                        <div class="table-static-action">
                            <button type="button" class="download-button">
                                <span>Download</span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18.408 12.9034C18.7349 12.9034 19 13.1658 19 13.4895V15.6002C19 17.4776 17.4623 19 15.566 19H4.43404C2.53774 19 1 17.4776 1 15.6002V13.4895C1 13.1658 1.26509 12.9034 1.59204 12.9034C1.91899 12.9034 2.18408 13.1658 2.18408 13.4895V15.6002C2.18408 16.8302 3.19166 17.8278 4.43408 17.8278H15.566C16.8084 17.8278 17.816 16.8302 17.816 15.6002V13.4895C17.816 13.1658 18.081 12.9034 18.408 12.9034ZM9.99998 2.00008C10.3136 2.00008 10.5709 2.24164 10.5906 2.54723L10.592 2.58621V12.2574L13.1485 9.89548C13.3771 9.68386 13.73 9.68664 13.9557 9.89409L13.9853 9.92402C14.199 10.1503 14.1962 10.4997 13.9867 10.7232L13.9564 10.7524L10.4077 14.0317C10.3965 14.0422 10.3859 14.0512 10.3747 14.061C10.3712 14.0631 10.3684 14.0658 10.3656 14.0679C10.3585 14.0735 10.3508 14.0791 10.3438 14.0839C10.3388 14.0874 10.3339 14.0909 10.3283 14.0944C10.3234 14.0979 10.3184 14.1013 10.3128 14.1041C10.3079 14.1076 10.303 14.1104 10.2973 14.1139C10.2896 14.1181 10.2819 14.1222 10.2734 14.1264L10.2643 14.1313C10.2573 14.1348 10.2495 14.1382 10.2425 14.1417C10.2369 14.1438 10.232 14.1459 10.227 14.148C10.22 14.1508 10.2137 14.1536 10.2073 14.1563L10.1898 14.1619C10.1848 14.164 10.1799 14.1654 10.1743 14.1668C10.1673 14.1689 10.1602 14.171 10.1525 14.173C10.1335 14.1786 10.1131 14.1828 10.0934 14.1856C10.0885 14.1863 10.0829 14.187 10.078 14.1877L10.0386 14.1918L9.99993 14.1925C9.9697 14.1925 9.93946 14.1904 9.90923 14.1863L9.88181 14.1814C9.7004 14.2176 9.50492 14.1696 9.35939 14.0352L5.80655 10.7523C5.56749 10.5316 5.55484 10.1606 5.77772 9.92395C6.00062 9.68727 6.37538 9.67474 6.61443 9.89541L9.40803 12.4765V2.58614C9.40803 2.26244 9.67303 2.00008 9.99998 2.00008Z" fill="black" stroke="black" stroke-width="0.3"/>
                                </svg>
                            </button>
                            <div class="download-confirm-dialog">
                                <div class="download-confirm-dialog-outer">
                                    <div class="download-confirm-dialog-messages">
                                        <p>
                                            The report will be available in <strong>My Downloads</strong> in <strong>30 min</strong>.
                                        </p>
                                        <p>
                                            Confirm if you want to proceed with download?
                                        </p>
                                    </div> 
                                    <button type="button" class="download-confirm-dialog-button">
                                        Download
                                    </button>   
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% comment %} <div class="table-action">
                        ${table_metadata?.actions?.table
                        ?.map(({ name, key, icon }) => {
                            return `<button type="button" class="each-table-action-button" data-key="${key}">
                                            ${name
                                    ? `<span>${name}</span>`
                                    : ""
                                } 
                                            ${icon
                                    ? `<img src="${icon}" alt="${name} icon"/>`
                                    : ""
                                }
                                        </button>`;
                        })
                        .join("")}
                    </div> {% endcomment %}
                `);
                function debounce(func, timeout = 300) {
                        let timer;
                        return (...args) => {
                            clearTimeout(timer);
                            timer = setTimeout(() => { func.apply(this, args); }, timeout);
                        };
                    }

                function searchInTable(value) {                        
                    telephonyOutgoingTable.search(value).draw()
                }
                const searchFieldChange = debounce((value) => searchInTable(value), 500);

                $(document)
                    .find("#table_search")
                    .on("change keyup paste", function () {
                        let searchValue = $(this).val();
                        console.log('print value search sms', searchValue)
                        searchFieldChange(searchValue);
                    });

                new $.fn.dataTable.FixedHeader(telephonyOutgoingTable, {
                    headerOffset: $(".table-search-box-telephony-outgoing").outerHeight(),
                    header: true,
                    footer: false,
                });

                function resizePaginationInputWidth() {
                    let value = $(document).find(".paginate_input").val();
                    if (value) {
                        $(document)
                            .find(".paginate_input")
                            .css({ width: `${value.length + 5}ch` });
                    }
                }

                resizePaginationInputWidth();

                $(document)
                    .find(".paginate_input")
                    .on("change keypress", function () {
                        resizePaginationInputWidth();
                    });
            }
    })



    let videoCallTable = $('#com-pkg-video-call-incoming-table').DataTable({
            responsive: true,
            ordering: false,
            info: false,
            paging: true,
            pagingType: "input",
            scrollX: true,
            processing: true,
            serverSide: true,
            order: [],
            language: {
                info: "Showing: _START_-_END_/_TOTAL_ entries",
                lengthMenu:
                    'Counts per page <select class="custom-table-page-count">' +
                    '<option value="10">10</option>' +
                    '<option value="25">25</option>' +
                    '<option value="50">50</option>' +
                    '<option value="100">100</option>' +
                    "</select>",
                paginate: {
                    first: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.84362 0.919211C8.05213 0.708929 8.05213 0.367994 7.84362 0.157712C7.63512 -0.0525706 7.29708 -0.0525706 7.08858 0.157712L3.65638 3.61925C3.63031 3.64553 3.60751 3.67386 3.58796 3.70372C3.45113 3.91272 3.47394 4.19675 3.65638 4.38075L7.08858 7.84229C7.29708 8.05257 7.63512 8.05257 7.84362 7.84229C8.05213 7.63201 8.05213 7.29107 7.84362 7.08079L4.78894 4L7.84362 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    last: `<svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.65638 0.919211C3.44787 0.708929 3.44787 0.367994 3.65638 0.157712C3.86488 -0.0525706 4.20292 -0.0525706 4.41142 0.157712L7.84362 3.61925C7.86969 3.64553 7.89249 3.67386 7.91204 3.70372C8.04887 3.91272 8.02606 4.19675 7.84362 4.38075L4.41142 7.84229C4.20292 8.05257 3.86488 8.05257 3.65638 7.84229C3.44787 7.63201 3.44787 7.29107 3.65638 7.08079L6.71106 4L3.65638 0.919211Z" fill="#1C1E27"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.156375 0.919211C-0.0521251 0.708929 -0.0521251 0.367994 0.156375 0.157712C0.364875 -0.0525706 0.702921 -0.0525706 0.911421 0.157712L4.34362 3.61925C4.36969 3.64553 4.39249 3.67386 4.41204 3.70372C4.54887 3.91272 4.52606 4.19675 4.34362 4.38075L0.911421 7.84229C0.702921 8.05257 0.364875 8.05257 0.156375 7.84229C-0.0521251 7.63201 -0.0521251 7.29107 0.156375 7.08079L3.21106 4L0.156375 0.919211Z" fill="#1C1E27"/>
                    </svg>
                    `,
                    next: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.656375 0.919211C0.447875 0.708929 0.447875 0.367994 0.656375 0.157712C0.864875 -0.0525706 1.20292 -0.0525706 1.41142 0.157712L4.84362 3.61925C4.86969 3.64553 4.89249 3.67386 4.91204 3.70372C5.04887 3.91272 5.02606 4.19675 4.84362 4.38075L1.41142 7.84229C1.20292 8.05257 0.864875 8.05257 0.656375 7.84229C0.447875 7.63201 0.447875 7.29107 0.656375 7.08079L3.71106 4L0.656375 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                    previous: `<svg xmlns="http://www.w3.org/2000/svg" width="5" height="8" viewBox="0 0 5 8" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.34362 0.919211C4.55213 0.708929 4.55213 0.367994 4.34362 0.157712C4.13512 -0.0525706 3.79708 -0.0525706 3.58858 0.157712L0.156375 3.61925C0.130313 3.64553 0.107508 3.67386 0.0879612 3.70372C-0.0488672 3.91272 -0.0260625 4.19675 0.156375 4.38075L3.58858 7.84229C3.79708 8.05257 4.13512 8.05257 4.34362 7.84229C4.55213 7.63201 4.55213 7.29107 4.34362 7.08079L1.28894 4L4.34362 0.919211Z" fill="#1C1E27"/>
                    </svg>`,
                },
                processing: `<span class="overlay-spinner"></span>`,
            },
            columns: [
                { data: 'id' },
                { data: 'start_time' },
                { data: 'meeting_host' },
                { data: 'created_by' },
                { data: 'room_id' },
                { data: 'end_time' },
                { data: 'status' },
            ],
            createdRow: function (row, data) {
                // Access the 'isBold' property in the data
                $(row).css('font-size', '14px');
                $(row).css('font-weight', '400');
                $(row).css('border-bottom', '1px solid #F0F3F4');
                $(row).css('padding', '14px 40px');
                $(row).css('height', '40px');
                $(row).css('cursor', 'pointer');
                $('td', row).eq(-1).css('text-align', 'right');
                $('td', row).eq(0).css('max-width', '100px');
            },
            ajax: function (d, callback) {
                console.log("sms table data", d)
                function flattenObject(obj, parentKey = "") {
                        let result = {};
                        for (let key in obj) {
                            if (obj.hasOwnProperty(key)) {
                                let fullKey = parentKey ? `${parentKey}[${key}]` : key;
                                if (typeof obj[key] === "object") {
                                    Object.assign(result, flattenObject(obj[key], fullKey));
                                } else {
                                    result[fullKey] = obj[key];
                                }
                            }
                        }

                        return result;
                }
                const flattenedObject = flattenObject({...d, search: d.search.value});

                dataTableApiQueries = flattenedObject;

                fetch(`./api/?action=fetch_videocall_records&${new URLSearchParams(flattenedObject)}`, {
                        method: "GET",
                        headers: {
                            'X-CSRFToken': "{{csrf_token|safe}}"
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        let newData = {
                                data: data.response.records,
                                recordsFiltered: data?.response?.total_records,
                                recordsTotal: data?.response?.total_records
                            }
                        callback(newData)
                    });
            },
            dom: '<"table-top" ><"table-search-box-video-call table-search-box">rt<"table-bottom" <"table-info" i> <"table-pagination-box" l<"table-pagination-box-divider">p> >',
            initComplete: function () { 
                let totalColumns = this.api().columns().count();
                videoCallTable.columns.adjust().draw();
                $(".table-search-box-video-call").html(`
                    <div class="table-search-input-box com-pkg-search-box">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <g clip-path="url(#clip0_2358_618)">
                            <path d="M13.9647 13.0221C15.0263 11.7505 15.6646 10.1148 15.6646 8.33314C15.6646 4.28923 12.375 1 8.33388 1C4.28957 1 1 4.28923 1 8.33314C1 12.3762 4.28957 15.6663 8.33388 15.6663C10.1158 15.6663 11.7516 15.0265 13.0233 13.9666L17.8612 18.8039C17.9909 18.9336 18.1612 19 18.333 19C18.5033 19 18.6752 18.9344 18.8049 18.8039C19.065 18.5438 19.065 18.122 18.8049 17.8619L13.9647 13.0221ZM8.33388 14.3321C5.02631 14.3321 2.33431 11.6403 2.33431 8.3331C2.33431 5.02587 5.02631 2.33413 8.33388 2.33413C11.6414 2.33413 14.3335 5.02587 14.3335 8.3331C14.3335 11.6403 11.6414 14.3321 8.33388 14.3321Z" fill="black" stroke="black" stroke-width="0.2"/>
                            </g>
                            <defs>
                            <clipPath id="clip0_2358_618">
                            <rect width="20" height="20" fill="white"/>
                            </clipPath>
                            </defs>
                        </svg>
                        <input id='table_search' type="text" placeholder="Search"/>
                    </div>
                    {% if has_export_perm %}
                        <div class="table-static-action">
                            <button type="button" class="download-button">
                                <span>Download</span>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18.408 12.9034C18.7349 12.9034 19 13.1658 19 13.4895V15.6002C19 17.4776 17.4623 19 15.566 19H4.43404C2.53774 19 1 17.4776 1 15.6002V13.4895C1 13.1658 1.26509 12.9034 1.59204 12.9034C1.91899 12.9034 2.18408 13.1658 2.18408 13.4895V15.6002C2.18408 16.8302 3.19166 17.8278 4.43408 17.8278H15.566C16.8084 17.8278 17.816 16.8302 17.816 15.6002V13.4895C17.816 13.1658 18.081 12.9034 18.408 12.9034ZM9.99998 2.00008C10.3136 2.00008 10.5709 2.24164 10.5906 2.54723L10.592 2.58621V12.2574L13.1485 9.89548C13.3771 9.68386 13.73 9.68664 13.9557 9.89409L13.9853 9.92402C14.199 10.1503 14.1962 10.4997 13.9867 10.7232L13.9564 10.7524L10.4077 14.0317C10.3965 14.0422 10.3859 14.0512 10.3747 14.061C10.3712 14.0631 10.3684 14.0658 10.3656 14.0679C10.3585 14.0735 10.3508 14.0791 10.3438 14.0839C10.3388 14.0874 10.3339 14.0909 10.3283 14.0944C10.3234 14.0979 10.3184 14.1013 10.3128 14.1041C10.3079 14.1076 10.303 14.1104 10.2973 14.1139C10.2896 14.1181 10.2819 14.1222 10.2734 14.1264L10.2643 14.1313C10.2573 14.1348 10.2495 14.1382 10.2425 14.1417C10.2369 14.1438 10.232 14.1459 10.227 14.148C10.22 14.1508 10.2137 14.1536 10.2073 14.1563L10.1898 14.1619C10.1848 14.164 10.1799 14.1654 10.1743 14.1668C10.1673 14.1689 10.1602 14.171 10.1525 14.173C10.1335 14.1786 10.1131 14.1828 10.0934 14.1856C10.0885 14.1863 10.0829 14.187 10.078 14.1877L10.0386 14.1918L9.99993 14.1925C9.9697 14.1925 9.93946 14.1904 9.90923 14.1863L9.88181 14.1814C9.7004 14.2176 9.50492 14.1696 9.35939 14.0352L5.80655 10.7523C5.56749 10.5316 5.55484 10.1606 5.77772 9.92395C6.00062 9.68727 6.37538 9.67474 6.61443 9.89541L9.40803 12.4765V2.58614C9.40803 2.26244 9.67303 2.00008 9.99998 2.00008Z" fill="black" stroke="black" stroke-width="0.3"/>
                                </svg>
                            </button>
                            <div class="download-confirm-dialog">
                                <div class="download-confirm-dialog-outer">
                                    <div class="download-confirm-dialog-messages">
                                        <p>
                                            The report will be available in <strong>My Downloads</strong> in <strong>30 min</strong>.
                                        </p>
                                        <p>
                                            Confirm if you want to proceed with download?
                                        </p>
                                    </div> 
                                    <button type="button" class="download-confirm-dialog-button">
                                        Download
                                    </button>   
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% comment %} <div class="table-action">
                        ${table_metadata?.actions?.table
                        ?.map(({ name, key, icon }) => {
                            return `<button type="button" class="each-table-action-button" data-key="${key}">
                                            ${name
                                    ? `<span>${name}</span>`
                                    : ""
                                } 
                                            ${icon
                                    ? `<img src="${icon}" alt="${name} icon"/>`
                                    : ""
                                }
                                        </button>`;
                        })
                        .join("")}
                    </div> {% endcomment %}
                `);
                function debounce(func, timeout = 300) {
                        let timer;
                        return (...args) => {
                            clearTimeout(timer);
                            timer = setTimeout(() => { func.apply(this, args); }, timeout);
                        };
                    }

                function searchInTable(value) {                        
                    videoCallTable.search(value).draw()
                }
                const searchFieldChange = debounce((value) => searchInTable(value), 500);

                $(document)
                    .find("#table_search")
                    .on("change keyup paste", function () {
                        let searchValue = $(this).val();
                        console.log('print value search sms', searchValue)
                        searchFieldChange(searchValue);
                    });

                new $.fn.dataTable.FixedHeader(videoCallTable, {
                    headerOffset: $(".table-search-box-video-call").outerHeight(),
                    header: true,
                    footer: false,
                });

                function resizePaginationInputWidth() {
                    let value = $(document).find(".paginate_input").val();
                    if (value) {
                        $(document)
                            .find(".paginate_input")
                            .css({ width: `${value.length + 5}ch` });
                    }
                }

                resizePaginationInputWidth();

                $(document)
                    .find(".paginate_input")
                    .on("change keypress", function () {
                        resizePaginationInputWidth();
                    });
            }
    })
    

    async function sendOrDraftEmail(url, reqType) {
        $(document).find(".overlay-spinner").show();

        let formData = new FormData();
        formData.append("to", $("#com-pkg-compose-email-to").val());
        formData.append("subject", $("#com-pkg-compose-email-subject").val());
        formData.append("body", $("#com-pkg-compose-email-body .ql-editor").html());

        var files = $('#com-pkg-compose-email-attachment')[0].files;
        console.log("file list", files, attatchmentsList)
        if (files.length > 0) {
            for (let i = 0; i < files.length; i++) {
                formData.append("attachments", files[i]);
            }
        }

        if (attatchmentsList?.length > 0) {
            attatchmentsList.forEach(el => formData.append("attachments", el.pk))
        }

        for (var pair of formData.entries()) {
            console.log(pair[0] + ', ' + pair[1]);
        }

        console.log("file form list", formData)

        function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        fetch(url, {
            method: reqType || "POST",
            headers: {
                'X-CSRFToken': "{{csrf_token|safe}}",
                'zelthycookie': getCookie('zelthycookie')
            },
            body: formData
        })
            .then((response) => response.json())
            .then((responseData) => {
                $(document).find(".overlay-spinner").hide();
                if (responseData?.success) {
                    window.location.reload();
                    console.log("fetched drafts here", responseData)
                } else {
                }
            })
            .catch(error => {
                $(document).find(".overlay-spinner").hide();
                ZToast("error", "Server Error", error?.message, 3000);
                throw (error);
            });
    }

    $("#com-pkg-save-draft").on("click", async function (event) {
        event.preventDefault()
        let url = `${window.location.origin}/communication/email/api/?action=draft`
        let reqType = "POST"
        if (opendDraftMail) {
            reqType = "PUT"
            url = `${window.location.origin}/communication/email/api/?action=update_draft&pk=${opendDraftMail}`
        }

        // Perform validation
        if (!validateForm()) {
            $("#com-pkg-email-validation").show()
            console.log("Form is not valid. Please check your inputs.");
            return
        } else {
            await sendOrDraftEmail(url, reqType);
        }

        
    })


    async function sendSMS(url, reqType) {

        let formData = new FormData();
        formData.append("to_number", $("#com-pkg-sms-to").val());
        formData.append("message", $("#com-pkg-compose-sms-textarea").val());

         function getCookie(cname) {
            let name = cname + "=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let ca = decodedCookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        fetch(url, {
            method: reqType || "POST",
            headers: {
                'X-CSRFToken': "{{csrf_token|safe}}",
                'zelthycookie': getCookie('zelthycookie')
            },
            body: formData
        })
            .then((response) => response.json())
            .then((responseData) => {
                $(document).find(".overlay-spinner").hide();
                if (responseData?.success) {
                    window.location.reload();
                    console.log("fetched drafts here", responseData)
                } else {
                }
            })
            .catch(error => {
                $(document).find(".overlay-spinner").hide();
                ZToast("error", "Server Error", error?.message, 3000);
                throw (error);
            });
    }

    $("#com-pkg-send-sms").on("click", async function (event) {
        event.preventDefault()
        let url = `${window.location.origin}/communication/sms/api/?action=send`
        let reqType = "POST"

        await sendSMS(url, reqType);
    })

    $("#com-pkg-audio-call").on('click', async function () {
        console.log("call number", $("#com-pkg-audio-call-to").val())
        let numberToCall = $("#com-pkg-audio-call-to").val()
        PlaceNiceCall(numberToCall)

    })


    $("#com-pkg-send-email").on("click", async function (event) {
        event.preventDefault()

        let url = `${window.location.origin}/communication/email/api/?action=send`

        if (opendDraftMail) {
            url = `${window.location.origin}/communication/email/api/?action=send&draft=true&pk=${opendDraftMail}`
        }

        $(document).find(".overlay-spinner").show();

        if (!validateForm()) {
            $("#com-pkg-email-validation").show()
            console.log("Form is not valid. Please check your inputs.");
            return
        } else {
            await sendOrDraftEmail(url);
        }
    })

    $("#compose-btn").on("click", async function (event) {
        $("#com-pkg-compose-email-to").val("")
        $("#com-pkg-compose-email-subject").val("")
        {% comment %} $("#com-pkg-compose-email-body .ql-editor").empty() {% endcomment %}

        quill.setContents([
            { insert: '' },
        ]);


        $("#attachments-list").text("")
    })

    function handleDraftMail(data) {
        $("#com-pkg-compose-email-to").val(data.to_email)
        $("#com-pkg-compose-email-subject").val(data.subject)


        const decodedContent = new DOMParser().parseFromString(data.email_body, 'text/html').body.textContent;

        const quillData = quill.clipboard.dangerouslyPasteHTML(decodedContent)


        $("#attachments-list").text(data?.attachments?.map(el => el.name)?.toString())

        opendDraftMail = data.pk
        attatchmentsList = data.attachments
        console.log('Row Clicked:', data?.attachments?.map(el => el.name)?.toString());
        const mailDrawer = document.getElementById("com-pkg-cta-email-modal")
        var bsOffcanvas = new bootstrap.Offcanvas(mailDrawer);
        bsOffcanvas.show();
    }

    $("#com-pkg-email-draft-search-input").keyup(function () {
        emailDraftTable.fnFilter(this.value);
    });
</script>

{% endblock %}

</html>